/*! CSS critic - v0.1.0 - 2012-10-28
* http://www.github.com/cburgmer/csscritic
* Copyright (c) 2012 Christoph Burgmer; Licensed MIT */
window.csscritic=function(e,t,n,r){var i=[];e.util={};var s=function(e){var t=!1;return e.forEach(function(e){e.resourceType==="page"&&(t=!0)}),t},o=function(e){var t=[];return e.forEach(function(e){e.url&&t.push(e.url)}),t};e.util.getImageForPageUrl=function(e,t,n,i,u){r.drawURL(e,{cache:!1,width:t,height:n},function(e,t){var n=t===undefined?[]:o(t);t!==undefined&&s(t)?u&&u():i&&i(e,n)})},e.util.getDataURIForImage=function(e){var n=t.document.createElement("canvas"),r=n.getContext("2d");return n.width=e.width,n.height=e.height,r.drawImage(e,0,0),n.toDataURL("image/png")},e.util.getImageForUrl=function(e,n,r){var i=new t.Image;i.onload=function(){n(i)},r&&(i.onerror=r),i.src=e},e.util.workAroundTransparencyIssueInFirefox=function(t,n){var r;try{r=e.util.getDataURIForImage(t)}catch(i){n(t);return}e.util.getImageForUrl(r,function(e){n(e)})},e.util.storeReferenceImage=function(n,r){var i,s;try{i=e.util.getDataURIForImage(r)}catch(o){throw t.alert("An error occurred reading the canvas. Are you sure you are using Firefox?\n"+o),o}s={referenceImageUri:i},localStorage.setItem(n,JSON.stringify(s))},e.util.readReferenceImage=function(t,n,r){var i=localStorage.getItem(t),s;i?(s=JSON.parse(i),e.util.getImageForUrl(s.referenceImageUri,function(e){n(e)},r)):r()};var u=function(t,r,i,s,o){var u={status:t,pageUrl:r,pageImage:i};return i&&(u.resizePageImage=function(t,n,i){e.util.getImageForPageUrl(r,t,n,function(e){u.pageImage=e,i(e)})},u.acceptPage=function(){e.util.storeReferenceImage(r,u.pageImage)}),s&&(u.referenceImage=s),o&&o.length&&(u.erroneousPageUrls=o),t==="failed"&&(u.differenceImageData=n.diff(i,s)),u},a=function(e,t,n,r,s){var o,a;if(!i.length)return;a=u(e,t,n,r,s);for(o=0;o<i.length;o++)i[o].reportComparison(a)};e.addReporter=function(e){i.push(e)},e.clearReporters=function(){i=[]};var f=function(t,r,i,s,o){e.util.getImageForPageUrl(t,r,i,function(r,i){var u,f;e.util.workAroundTransparencyIssueInFirefox(r,function(e){s?(u=n.equal(e,s),f=u?"passed":"failed"):f="referenceMissing",o&&o(f),a(f,t,r,s,i)})},function(){var e="error";o&&o(e),a(e,t,null)})};return e.compare=function(t,n){e.util.readReferenceImage(t,function(e){f(t,e.width,e.height,e,n)},function(){f(t,800,600,null,n)})},e}(window.csscritic||{},window,imagediff,rasterizeHTML),window.csscritic=function(e,t){e.basicHTMLReporterUtil={},e.basicHTMLReporterUtil.getCanvasForImageData=function(e){var n=t.createElement("canvas"),r;return n.height=e.height,n.width=e.width,r=n.getContext("2d"),r.putImageData(e,0,0),n};var n=function(e,t){var n=e.style.width,r=e.style.height;e.onmouseup=function(){if(n!==e.style.width||r!==e.style.height)n=e.style.width,r=e.style.height,t(n,r)}},r=function(){var e="csscritic_basichtmlreporter",n=t.getElementById(e);return n===null&&(n=t.createElement("div"),n.id=e,t.getElementsByTagName("body")[0].appendChild(n)),n},i=function(e,r){var i=t.createElement("div"),s=t.createElement("div"),o=t.createElement("div"),u;return s.className="pageImageContainer",s.style.width=e.pageImage.width+"px",s.style.height=e.pageImage.height+"px",r&&(u=t.createElement("span"),u.className="caption",u.textContent="Page",i.appendChild(u)),o.className="innerPageImageContainer",o.appendChild(e.pageImage),s.appendChild(o),n(s,function(){var t=parseInt(s.style.width,10),n=parseInt(s.style.height,10),r=e.pageImage;e.resizePageImage(t,n,function(e){o.removeChild(r),o.appendChild(e)})}),i.className="outerPageCanvasContainer",i.appendChild(s),i},s=function(e){var n=t.createElement("div"),r=t.createElement("div"),i=t.createElement("span");return r.className="referenceImageContainer",r.appendChild(e.referenceImage),i.className="caption",i.textContent="Reference",n.className="outerReferenceImageContainer",n.appendChild(i),n.appendChild(r),n},o=function(){var e=t.createElement("span");return e.className="finished",e.style.display="none",e},u=function(e){var n=t.createElement("div"),r=t.createElement("button"),i=o();return r.onclick=function(){e.acceptPage(),i.style.display=""},r.textContent="Accept the rendered page",n.className="saveHint warning",n.appendChild(r),n.appendChild(t.createTextNode("and save this as later reference.")),n.appendChild(i),n},a=function(e){var n=t.createElement("div"),r=t.createElement("button"),i=o();return r.onclick=function(){e.acceptPage(),i.style.display=""},r.textContent="accept the rendered page",n.className="updateHint warning",n.appendChild(t.createTextNode("You can")),n.appendChild(r),n.appendChild(t.createTextNode("thus making it the new reference.")),n.appendChild(i),n},f=function(e){var n=t.createElement("div"),r=t.createElement("ul");return n.className="loadErrors warning",n.appendChild(t.createTextNode("Could not load the referenced resources:")),n.appendChild(r),e.erroneousPageUrls.forEach(function(e){var n=t.createElement("li");n.textContent=e,r.appendChild(n)}),n.appendChild(t.createTextNode("Make sure the paths lie within the same origin as this document.")),n},l=function(e){var n=t.createElement("div");return n.className="errorMsg warning",n.textContent="The page '"+e.pageUrl+"' could not be read. Make sure the path lies within the same origin as this document.",n},c=function(n){var r=t.createElement("div");return r.className="differenceCanvasContainer",r.appendChild(e.basicHTMLReporterUtil.getCanvasForImageData(n.differenceImageData)),r},h=function(e){var n=t.createElement("span");return n.className="status",e.status==="passed"?n.textContent="passed":e.status==="failed"?n.textContent="failed":e.status==="referenceMissing"?n.textContent="missing reference":e.status==="error"&&(n.textContent="error"),n},p=function(e){var n=t.createElement("span");return n.className="pageUrl",n.textContent=e.pageUrl,n},d=function(e){var n=t.getElementById(e);return n||(n=t.createElement("div"),n.id=e,n.style.display="none",n.style.position="absolute",t.getElementsByTagName("body")[0].appendChild(n)),n},v=function(e){while(e.hasChildNodes())e.removeChild(e.lastChild)},m=function(e,t){e.onmouseover=function(e){var n=d("csscritic_basichtmlreporter_tooltip"),r=t.referenceImage;v(n),n.style.display="block",n.style.top=e.clientY+10+"px",n.style.left=e.clientX+10+"px",n.appendChild(r)},e.onmouseout=function(){var e=d("csscritic_basichtmlreporter_tooltip");e.style.display="none"}},g=function(e){var n=t.createElement("div");return n.className="comparison "+e.status,n.appendChild(p(e)),n.appendChild(h(e)),e.erroneousPageUrls&&n.appendChild(f(e)),e.status==="failed"?(n.appendChild(c(e)),n.appendChild(i(e,!0)),n.appendChild(s(e)),n.appendChild(a(e))):e.status==="referenceMissing"?(n.appendChild(u(e)),n.appendChild(i(e))):e.status==="error"?n.appendChild(l(e)):e.status==="passed"&&m(n,e),n},y=function(e){var t=g(e),n=r();n.appendChild(t)};return e.BasicHTMLReporter=function(){return{reportComparison:y}},e}(window.csscritic||{},window.document);