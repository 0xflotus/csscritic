/*! CSS critic - v0.1.0 - 2012-10-28
* http://www.github.com/cburgmer/csscritic
* Copyright (c) 2012 Christoph Burgmer; Licensed MIT */
window.csscritic=function(){var e={},t=[];e.util={};var n=function(e){var t=!1;return e.forEach(function(e){e.resourceType==="page"&&(t=!0)}),t},r=function(e){var t=[];return e.forEach(function(e){e.url&&t.push(e.url)}),t};e.util.getImageForPageUrl=function(e,t,i,s,o){rasterizeHTML.drawURL(e,{cache:!1,width:t,height:i},function(e,t){var i=t===undefined?[]:r(t);t!==undefined&&n(t)?o&&o():s&&s(e,i)})},e.util.getDataURIForImage=function(e){var t=window.document.createElement("canvas"),n=t.getContext("2d");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),t.toDataURL("image/png")},e.util.getImageForUrl=function(e,t,n){var r=new window.Image;r.onload=function(){t(r)},n&&(r.onerror=n),r.src=e},e.util.workAroundTransparencyIssueInFirefox=function(t,n){e.util.getImageForUrl(e.util.getDataURIForImage(t),function(e){n(e)})},e.util.storeReferenceImage=function(t,n){var r,i;try{r=e.util.getDataURIForImage(n)}catch(s){throw window.alert("An error occurred reading the canvas. Are you sure you are using Firefox?\n"+s),s}i={referenceImageUri:r},localStorage.setItem(t,JSON.stringify(i))},e.util.readReferenceImage=function(t,n,r){var i=localStorage.getItem(t),s;i?(s=JSON.parse(i),e.util.getImageForUrl(s.referenceImageUri,function(e){n(e)},r)):r()};var i=function(t,n,r,i,s){var o={status:t,pageUrl:n,pageImage:r};return r&&(o.resizePageImage=function(t,r,i){e.util.getImageForPageUrl(n,t,r,function(e){o.pageImage=e,i(e)})},o.acceptPage=function(){e.util.storeReferenceImage(n,o.pageImage)}),i&&(o.referenceImage=i),s&&s.length&&(o.erroneousPageUrls=s),t==="failed"&&(o.differenceImageData=imagediff.diff(r,i)),o},s=function(e,n,r,s,o){var u,a;if(!t.length)return;a=i(e,n,r,s,o);for(u=0;u<t.length;u++)t[u].reportComparison(a)};e.addReporter=function(e){t.push(e)},e.clearReporters=function(){t=[]};var o=function(t,n,r,i,o){e.util.getImageForPageUrl(t,n,r,function(n,r){var u,a;e.util.workAroundTransparencyIssueInFirefox(n,function(e){i?(u=imagediff.equal(e,i),a=u?"passed":"failed"):a="referenceMissing",o&&o(a),s(a,t,n,i,r)})},function(){var e="error";o&&o(e),s(e,t,null)})};return e.compare=function(t,n){e.util.readReferenceImage(t,function(e){o(t,e.width,e.height,e,n)},function(){o(t,800,600,null,n)})},e}(),csscritic.basicHTMLReporterUtils=function(){var e={};return e.getCanvasForImageData=function(e){var t=window.document.createElement("canvas"),n;return t.height=e.height,t.width=e.width,n=t.getContext("2d"),n.putImageData(e,0,0),t},e}(),csscritic.BasicHTMLReporter=function(){var e={},t=function(e,t){var n=e.style.width,r=e.style.height;e.onmouseup=function(){if(n!==e.style.width||r!==e.style.height)n=e.style.width,r=e.style.height,t(n,r)}},n=function(){var e="csscritic_basichtmlreporter",t=window.document.getElementById(e);return t===null&&(t=window.document.createElement("div"),t.id=e,window.document.getElementsByTagName("body")[0].appendChild(t)),t},r=function(e,n){var r=window.document.createElement("div"),i=window.document.createElement("div"),s=window.document.createElement("div"),o;return i.className="pageImageContainer",i.style.width=e.pageImage.width+"px",i.style.height=e.pageImage.height+"px",n&&(o=window.document.createElement("span"),o.className="caption",o.textContent="Page",r.appendChild(o)),s.className="innerPageImageContainer",s.appendChild(e.pageImage),i.appendChild(s),t(i,function(){var t=parseInt(i.style.width,10),n=parseInt(i.style.height,10),r=e.pageImage;e.resizePageImage(t,n,function(e){s.removeChild(r),s.appendChild(e)})}),r.className="outerPageCanvasContainer",r.appendChild(i),r},i=function(e){var t=window.document.createElement("div"),n=window.document.createElement("div"),r=window.document.createElement("span");return n.className="referenceImageContainer",n.appendChild(e.referenceImage),r.className="caption",r.textContent="Reference",t.className="outerReferenceImageContainer",t.appendChild(r),t.appendChild(n),t},s=function(){var e=window.document.createElement("span");return e.className="finished",e.style.display="none",e},o=function(e){var t=window.document.createElement("div"),n=window.document.createElement("button"),r=s();return n.onclick=function(){e.acceptPage(),r.style.display=""},n.textContent="Accept the rendered page",t.className="saveHint warning",t.appendChild(n),t.appendChild(window.document.createTextNode("and save this as later reference.")),t.appendChild(r),t},u=function(e){var t=window.document.createElement("div"),n=window.document.createElement("button"),r=s();return n.onclick=function(){e.acceptPage(),r.style.display=""},n.textContent="accept the rendered page",t.className="updateHint warning",t.appendChild(window.document.createTextNode("You can")),t.appendChild(n),t.appendChild(window.document.createTextNode("thus making it the new reference.")),t.appendChild(r),t},a=function(e){var t=window.document.createElement("div"),n=window.document.createElement("ul");return t.className="loadErrors warning",t.appendChild(window.document.createTextNode("Could not load the referenced resources:")),t.appendChild(n),e.erroneousPageUrls.forEach(function(e){var t=window.document.createElement("li");t.textContent=e,n.appendChild(t)}),t.appendChild(window.document.createTextNode("Make sure the paths lie within the same origin as this document.")),t},f=function(e){var t=window.document.createElement("div");return t.className="errorMsg warning",t.textContent="The page '"+e.pageUrl+"' could not be read. Make sure the path lies within the same origin as this document.",t},l=function(e){var t=window.document.createElement("div");return t.className="differenceCanvasContainer",t.appendChild(csscritic.basicHTMLReporterUtils.getCanvasForImageData(e.differenceImageData)),t},c=function(e){var t=window.document.createElement("span");return t.className="status",e.status==="passed"?t.textContent="passed":e.status==="failed"?t.textContent="failed":e.status==="referenceMissing"?t.textContent="missing reference":e.status==="error"&&(t.textContent="error"),t},h=function(e){var t=window.document.createElement("span");return t.className="pageUrl",t.textContent=e.pageUrl,t},p=function(e){var t=window.document.getElementById(e);return t||(t=window.document.createElement("div"),t.id=e,t.style.display="none",t.style.position="absolute",window.document.getElementsByTagName("body")[0].appendChild(t)),t},d=function(e){while(e.hasChildNodes())e.removeChild(e.lastChild)},v=function(e,t){e.onmouseover=function(e){var n=p("csscritic_basichtmlreporter_tooltip"),r=t.referenceImage;d(n),n.style.display="block",n.style.top=e.clientY+10+"px",n.style.left=e.clientX+10+"px",n.appendChild(r)},e.onmouseout=function(){var e=p("csscritic_basichtmlreporter_tooltip");e.style.display="none"}},m=function(e){var t=window.document.createElement("div");return t.className="comparison "+e.status,t.appendChild(h(e)),t.appendChild(c(e)),e.erroneousPageUrls&&t.appendChild(a(e)),e.status==="failed"?(t.appendChild(l(e)),t.appendChild(r(e,!0)),t.appendChild(i(e)),t.appendChild(u(e))):e.status==="referenceMissing"?(t.appendChild(o(e)),t.appendChild(r(e))):e.status==="error"?t.appendChild(f(e)):e.status==="passed"&&v(t,e),t};return e.reportComparison=function(e){var t=m(e),r=n();r.appendChild(t)},e};