/*! CSS critic - v0.1.0 - 2012-09-15
* http://www.github.com/cburgmer/csscritic
* Copyright (c) 2012 Christoph Burgmer; Licensed MIT */
var csscritic=function(){var e={},t=[];e.util={};var n=function(e){var t=!1;return e.forEach(function(e){e.resourceType==="page"&&(t=!0)}),t},r=function(e){var t=[];return e.forEach(function(e){e.url&&t.push(e.url)}),t};e.util.drawPageUrl=function(e,t,i,s,o,u){t.width=i,t.height=s,t.getContext("2d").clearRect(0,0,i,s),rasterizeHTML.drawURL(e,t,function(e,t){var i=t===undefined?[]:r(t);t!==undefined&&n(t)?u&&u():o&&o(i)})},e.util.getCanvasForPageUrl=function(t,n,r,i,s){var o=window.document.createElement("canvas");e.util.drawPageUrl(t,o,n,r,function(e){i(o,e)},s)},e.util.getImageForUrl=function(e,t,n){var r=new window.Image;r.onload=function(){t(r)},n&&(r.onerror=n),r.src=e},e.util.getCanvasForImageData=function(e){var t=window.document.createElement("canvas"),n;return t.height=e.height,t.width=e.width,n=t.getContext("2d"),n.putImageData(e,0,0),t},e.util.storeReferenceImage=function(e,t){var n,r;try{n=t.toDataURL("image/png")}catch(i){throw window.alert("An error occurred reading the canvas. Are you sure you are using Firefox?\n"+i),i}r={referenceImageUri:n},localStorage.setItem(e,JSON.stringify(r))},e.util.readReferenceImage=function(t,n,r){var i=localStorage.getItem(t),s;i?(s=JSON.parse(i),e.util.getImageForUrl(s.referenceImageUri,function(e){n(e)},r)):r()};var i=function(t,n,r,i,s){var o={status:t,pageUrl:n,pageCanvas:r};return r&&(o.resizePageCanvas=function(t,i,s){e.util.drawPageUrl(n,r,t,i,s)},o.acceptPage=function(){e.util.storeReferenceImage(n,r)}),i&&(o.referenceImage=i),s&&s.length&&(o.erroneousPageUrls=s),t==="failed"&&(o.differenceImageData=imagediff.diff(r,i)),o},s=function(e,n,r,s,o){var u,a;if(!t.length)return;a=i(e,n,r,s,o);for(u=0;u<t.length;u++)t[u].reportComparison(a)};e.addReporter=function(e){t.push(e)},e.clearReporters=function(){t=[]};var o=function(t,n,r,i,o){e.util.getCanvasForPageUrl(t,n,r,function(e,n){var r,u;i?(r=imagediff.equal(e,i),u=r?"passed":"failed"):u="referenceMissing",o&&o(u),s(u,t,e,i,n)},function(){var e="error";o&&o(e),s(e,t,null)})};return e.compare=function(t,n){e.util.readReferenceImage(t,function(e){o(t,e.width,e.height,e,n)},function(){o(t,800,600,null,n)})},e}();csscritic.BasicHTMLReporter=function(){var e={},t=null,n=function(e,t){var n=e.style.width,r=e.style.height;e.onmouseup=function(){if(n!==e.style.width||r!==e.style.height)n=e.style.width,r=e.style.height,t(n,r)}},r=function(){t===null&&(t=window.document.createElement("div"),t.id="csscritic_basichtmlreporter",window.document.getElementsByTagName("body")[0].appendChild(t))},i=function(e,t){var r=window.document.createElement("div"),i=window.document.createElement("div"),s=window.document.createElement("div"),o;return i.className="pageCanvasContainer",i.style.width=e.pageCanvas.width+"px",i.style.height=e.pageCanvas.height+"px",t&&(o=window.document.createElement("span"),o.className="caption",o.textContent="Page",r.appendChild(o)),s.className="innerPageCanvasContainer",s.appendChild(e.pageCanvas),i.appendChild(s),n(i,function(){var t=parseInt(i.style.width,10),n=parseInt(i.style.height,10);e.resizePageCanvas(t,n)}),r.className="outerPageCanvasContainer",r.appendChild(i),r},s=function(e){var t=window.document.createElement("div"),n=window.document.createElement("div"),r=window.document.createElement("span");return n.className="referenceImageContainer",n.appendChild(e.referenceImage),r.className="caption",r.textContent="Reference",t.className="outerReferenceImageContainer",t.appendChild(r),t.appendChild(n),t},o=function(){var e=window.document.createElement("span");return e.className="finished",e.style.display="none",e},u=function(e){var t=window.document.createElement("div"),n=window.document.createElement("button"),r=o();return n.onclick=function(){e.acceptPage(),r.style.display=""},n.textContent="Accept the rendered page",t.className="saveHint warning",t.appendChild(n),t.appendChild(window.document.createTextNode("and save this as later reference.")),t.appendChild(r),t},a=function(e){var t=window.document.createElement("div"),n=window.document.createElement("button"),r=o();return n.onclick=function(){e.acceptPage(),r.style.display=""},n.textContent="accept the rendered page",t.className="updateHint warning",t.appendChild(window.document.createTextNode("You can")),t.appendChild(n),t.appendChild(window.document.createTextNode("thus making it the new reference.")),t.appendChild(r),t},f=function(e){var t=window.document.createElement("div"),n=window.document.createElement("ul");return t.className="loadErrors warning",t.appendChild(window.document.createTextNode("Could not load the referenced resources:")),t.appendChild(n),e.erroneousPageUrls.forEach(function(e){var t=window.document.createElement("li");t.textContent=e,n.appendChild(t)}),t.appendChild(window.document.createTextNode("Make sure the paths lie within the same origin as this document.")),t},l=function(e){var t=window.document.createElement("div");return t.className="errorMsg warning",t.textContent="The page '"+e.pageUrl+"' could not be read. Make sure the path lies within the same origin as this document.",t},c=function(e){var t=window.document.createElement("div");return t.className="differenceCanvasContainer",t.appendChild(csscritic.util.getCanvasForImageData(e.differenceImageData)),t},h=function(e){var t=window.document.createElement("span");return t.className="status",e.status==="passed"?t.textContent="passed":e.status==="failed"?t.textContent="failed":e.status==="referenceMissing"?t.textContent="missing reference":e.status==="error"&&(t.textContent="error"),t},p=function(e){var t=window.document.createElement("span");return t.className="pageUrl",t.textContent=e.pageUrl,t},d=function(e){var t=window.document.createElement("div");return t.className="comparison "+e.status,t.appendChild(p(e)),t.appendChild(h(e)),e.erroneousPageUrls&&t.appendChild(f(e)),e.status==="failed"?(t.appendChild(c(e)),t.appendChild(i(e,!0)),t.appendChild(s(e)),t.appendChild(a(e))):e.status==="referenceMissing"?(t.appendChild(u(e)),t.appendChild(i(e))):e.status==="error"&&t.appendChild(l(e)),t};return e.reportComparison=function(e){var n=d(e);r(),t.appendChild(n)},e};