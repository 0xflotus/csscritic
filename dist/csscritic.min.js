/*! CSS critic - v0.1.0 - 2012-09-08
* http://www.github.com/cburgmer/csscritic
* Copyright (c) 2012 Christoph Burgmer; Licensed MIT */
var csscritic=function(){var e={},t=[];e.util={};var n=function(e){var t=!1;return e.forEach(function(e){e.resourceType==="page"&&(t=!0)}),t};e.util.drawPageUrl=function(e,t,r,i,s,o){t.width=r,t.height=i,t.getContext("2d").clearRect(0,0,r,i),rasterizeHTML.drawURL(e,t,function(e,t){t!==undefined&&n(t)?o&&o():s&&s()})},e.util.getCanvasForPageUrl=function(t,n,r,i,s){var o=window.document.createElement("canvas");e.util.drawPageUrl(t,o,n,r,function(){i(o)},s)},e.util.getImageForUrl=function(e,t,n){var r=new window.Image;r.onload=function(){t(r)},n&&(r.onerror=n),r.src=e},e.util.getCanvasForImageData=function(e){var t=window.document.createElement("canvas"),n;return t.height=e.height,t.width=e.width,n=t.getContext("2d"),n.putImageData(e,0,0),t},e.util.storeReferenceImage=function(e,t){var n=t.toDataURL("image/png"),r={referenceImageUri:n};localStorage.setItem(e,JSON.stringify(r))},e.util.readReferenceImage=function(t,n,r){var i=localStorage.getItem(t),s;i?(s=JSON.parse(i),e.util.getImageForUrl(s.referenceImageUri,function(e){n(e)},r)):r()};var r=function(t,n,r,i){var s={status:t,pageUrl:n,pageCanvas:r,referenceImage:i};return r&&(s.resizePageCanvas=function(t,i,s){e.util.drawPageUrl(n,r,t,i,s)},s.acceptPage=function(){e.util.storeReferenceImage(n,r)}),t==="failed"&&(s.differenceImageData=imagediff.diff(r,i)),s},i=function(e,n,i,s){var o,u;if(!t.length)return;u=r(e,n,i,s);for(o=0;o<t.length;o++)t[o].reportComparison(u)};e.addReporter=function(e){t.push(e)},e.clearReporters=function(){t=[]};var s=function(e,t){var n="error";t&&t(n),i(n,e,null)};return e.compare=function(t,n){e.util.readReferenceImage(t,function(r){e.util.getCanvasForPageUrl(t,r.width,r.height,function(e){var s=imagediff.equal(e,r),o=s?"passed":"failed";n&&n(o),i(o,t,e,r)},function(){s(t,n)})},function(){e.util.getCanvasForPageUrl(t,800,600,function(e){var r="referenceMissing";n&&n(r),i(r,t,e)},function(){s(t,n)})})},e}();csscritic.BasicHTMLReporter=function(){var e={},t=null,n=function(e,t){var n=e.style.width,r=e.style.height;e.onmouseup=function(){if(n!==e.style.width||r!==e.style.height)n=e.style.width,r=e.style.height,t(n,r)}},r=function(){t===null&&(t=window.document.createElement("div"),t.id="csscritic_basichtmlreporter",window.document.getElementsByTagName("body")[0].appendChild(t))},i=function(e,t){var r=window.document.createElement("div"),i=window.document.createElement("div"),s=window.document.createElement("div"),o;return i.className="pageCanvasContainer",i.style.width=e.pageCanvas.width+"px",i.style.height=e.pageCanvas.height+"px",t&&(o=window.document.createElement("span"),o.className="caption",o.textContent="Page",r.appendChild(o)),s.className="innerPageCanvasContainer",s.appendChild(e.pageCanvas),i.appendChild(s),n(i,function(){var t=parseInt(i.style.width,10),n=parseInt(i.style.height,10);e.resizePageCanvas(t,n)}),r.className="outerPageCanvasContainer",r.appendChild(i),r},s=function(e){var t=window.document.createElement("div"),n=window.document.createElement("div"),r=window.document.createElement("span");return n.className="referenceImageContainer",n.appendChild(e.referenceImage),r.className="caption",r.textContent="Reference",t.className="outerReferenceImageContainer",t.appendChild(r),t.appendChild(n),t},o=function(e){var t=window.document.createElement("div"),n=window.document.createElement("button");return n.onclick=e.acceptPage,n.textContent="Accept the rendered page",t.className="saveHint warning",t.appendChild(n),t.appendChild(window.document.createTextNode("and save this as later reference.")),t},u=function(e){var t=window.document.createElement("div"),n=window.document.createElement("button");return n.onclick=e.acceptPage,n.textContent="accept the rendered page",t.className="updateHint warning",t.appendChild(window.document.createTextNode("You can")),t.appendChild(n),t.appendChild(window.document.createTextNode("thus making it the new reference.")),t},a=function(e){var t=window.document.createElement("div");return t.className="errorMsg warning",t.textContent="The page '"+e.pageUrl+"' could not be read. Make sure the path lies within the same origin as this document.",t},f=function(e){var t=window.document.createElement("div");return t.className="differenceCanvasContainer",t.appendChild(csscritic.util.getCanvasForImageData(e.differenceImageData)),t},l=function(e){var t=window.document.createElement("span");return t.className="status",e.status==="passed"?t.textContent="passed":e.status==="failed"?t.textContent="failed":e.status==="referenceMissing"?t.textContent="missing reference":e.status==="error"&&(t.textContent="error"),t},c=function(e){var t=window.document.createElement("span");return t.className="pageUrl",t.textContent=e.pageUrl,t},h=function(e){var t=window.document.createElement("div");return t.className="comparison "+e.status,t.appendChild(c(e)),t.appendChild(l(e)),e.status==="failed"?(t.appendChild(f(e)),t.appendChild(i(e,!0)),t.appendChild(s(e)),t.appendChild(u(e))):e.status==="referenceMissing"?(t.appendChild(o(e)),t.appendChild(i(e))):e.status==="error"&&t.appendChild(a(e)),t};return e.reportComparison=function(e){var n=h(e);r(),t.appendChild(n)},e};