/*! CSS critic - v0.1.0 - 2012-11-04
* http://www.github.com/cburgmer/csscritic
* Copyright (c) 2012 Christoph Burgmer; Licensed MIT */
window.csscritic=function(e,t){e.renderer=e.renderer||{};var n=function(e){var t=!1;return e.forEach(function(e){e.resourceType==="page"&&(t=!0)}),t},r=function(e){var t=[];return e.forEach(function(e){e.url&&t.push(e.url)}),t};return e.renderer.browserRenderer=function(e,i,s,o,u){t.drawURL(e,{cache:!1,width:i,height:s},function(e,t){var i=t===undefined?[]:r(t);t!==undefined&&n(t)?u&&u():o(e,i)})},e.renderer.getImageForPageUrl=e.renderer.browserRenderer,e}(window.csscritic||{},rasterizeHTML),window.csscritic=function(e,t,n,r){var i=[];e.util={},e.util.getDataURIForImage=function(e){var t=n.document.createElement("canvas"),r=t.getContext("2d");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),t.toDataURL("image/png")},e.util.getImageForUrl=function(e,t,r){var i=new n.Image;i.onload=function(){t(i)},r&&(i.onerror=r),i.src=e},e.util.workAroundTransparencyIssueInFirefox=function(t,n){var r;try{r=e.util.getDataURIForImage(t)}catch(i){n(t);return}e.util.getImageForUrl(r,function(e){n(e)})},e.util.storeReferenceImage=function(t,r){var i,s;try{i=e.util.getDataURIForImage(r)}catch(o){throw n.alert("An error occurred reading the canvas. Are you sure you are using Firefox?\n"+o),o}s={referenceImageUri:i},localStorage.setItem(t,JSON.stringify(s))},e.util.readReferenceImage=function(t,n,r){var i=localStorage.getItem(t),s;i?(s=JSON.parse(i),e.util.getImageForUrl(s.referenceImageUri,function(e){n(e)},r)):r()};var s=function(n,r,i,s,o){var u={status:n,pageUrl:r,pageImage:i};return i&&(u.resizePageImage=function(e,n,i){t.getImageForPageUrl(r,e,n,function(e){u.pageImage=e,i(e)})},u.acceptPage=function(){e.util.storeReferenceImage(r,u.pageImage)}),s&&(u.referenceImage=s),o&&o.length&&(u.erroneousPageUrls=o),u},o=function(e,t,n,r,o){var u,a;if(!i.length)return;a=s(e,t,n,r,o);for(u=0;u<i.length;u++)i[u].reportComparison(a)};e.addReporter=function(e){i.push(e)},e.clearReporters=function(){i=[]};var u=function(n,i,s,u,a){t.getImageForPageUrl(n,i,s,function(t,i){var s,f;e.util.workAroundTransparencyIssueInFirefox(t,function(e){u?(s=r.equal(e,u),f=s?"passed":"failed"):f="referenceMissing",a&&a(f),o(f,n,t,u,i)})},function(){var e="error";a&&a(e),o(e,n,null)})};return e.compare=function(t,n){e.util.readReferenceImage(t,function(e){u(t,e.width,e.height,e,n)},function(){u(t,800,600,null,n)})},e}(window.csscritic||{},window.csscritic.renderer,window,imagediff),window.csscritic=function(e,t){e.basicHTMLReporterUtil={},e.basicHTMLReporterUtil.getDifferenceCanvas=function(e,n){var r=imagediff.diff(e,n),i=t.createElement("canvas"),s;return i.height=r.height,i.width=r.width,s=i.getContext("2d"),s.putImageData(r,0,0),i};var n=function(e,t){var n=e.style.width,r=e.style.height;e.onmouseup=function(){if(n!==e.style.width||r!==e.style.height)n=e.style.width,r=e.style.height,t(n,r)}},r=function(){var e="csscritic_basichtmlreporter",n=t.getElementById(e);return n===null&&(n=t.createElement("div"),n.id=e,t.getElementsByTagName("body")[0].appendChild(n)),n},i=function(e,r){var i=t.createElement("div"),s=t.createElement("div"),o=t.createElement("div"),u;return s.className="pageImageContainer",s.style.width=e.pageImage.width+"px",s.style.height=e.pageImage.height+"px",r&&(u=t.createElement("span"),u.className="caption",u.textContent="Page",i.appendChild(u)),o.className="innerPageImageContainer",o.appendChild(e.pageImage),s.appendChild(o),n(s,function(){var t=parseInt(s.style.width,10),n=parseInt(s.style.height,10),r=e.pageImage;e.resizePageImage(t,n,function(e){o.removeChild(r),o.appendChild(e)})}),i.className="outerPageImageContainer",i.appendChild(s),i},s=function(e){var n=t.createElement("div"),r=t.createElement("div"),i=t.createElement("span");return r.className="referenceImageContainer",r.appendChild(e.referenceImage),i.className="caption",i.textContent="Reference",n.className="outerReferenceImageContainer",n.appendChild(i),n.appendChild(r),n},o=function(){var e=t.createElement("span");return e.className="finished",e.style.display="none",e},u=function(e){var n=t.createElement("div"),r=t.createElement("button"),i=o();return r.onclick=function(){e.acceptPage(),i.style.display=""},r.textContent="Accept the rendered page",n.className="saveHint warning",n.appendChild(r),n.appendChild(t.createTextNode("and save this as later reference.")),n.appendChild(i),n},a=function(e){var n=t.createElement("div"),r=t.createElement("button"),i=o();return r.onclick=function(){e.acceptPage(),i.style.display=""},r.textContent="accept the rendered page",n.className="updateHint warning",n.appendChild(t.createTextNode("You can")),n.appendChild(r),n.appendChild(t.createTextNode("thus making it the new reference.")),n.appendChild(i),n},f=function(e){var n=t.createElement("div"),r=t.createElement("ul");return n.className="loadErrors warning",n.appendChild(t.createTextNode("Could not load the referenced resources:")),n.appendChild(r),e.erroneousPageUrls.forEach(function(e){var n=t.createElement("li");n.textContent=e,r.appendChild(n)}),n.appendChild(t.createTextNode("Make sure the paths lie within the same origin as this document.")),n},l=function(e){var n=t.createElement("div");return n.className="errorMsg warning",n.textContent="The page '"+e.pageUrl+"' could not be read. Make sure the path lies within the same origin as this document.",n},c=function(n){var r=t.createElement("div");return r.className="differenceCanvasContainer",r.appendChild(e.basicHTMLReporterUtil.getDifferenceCanvas(n.pageImage,n.referenceImage)),r},h=function(e){var n=t.createElement("span");return n.className="status",e.status==="passed"?n.textContent="passed":e.status==="failed"?n.textContent="failed":e.status==="referenceMissing"?n.textContent="missing reference":e.status==="error"&&(n.textContent="error"),n},p=function(e){var n=t.createElement("a");return n.className="pageUrl",n.textContent=e.pageUrl,n.href=e.pageUrl,n},d=function(e){var n=t.getElementById(e);return n||(n=t.createElement("div"),n.id=e,n.style.display="none",n.style.position="absolute",t.getElementsByTagName("body")[0].appendChild(n)),n},v=function(e){while(e.hasChildNodes())e.removeChild(e.lastChild)},m=function(e,t){e.onmouseover=function(e){var n=d("csscritic_basichtmlreporter_tooltip"),r=t.referenceImage;v(n),n.style.display="block",n.style.top=e.pageY+10+"px",n.style.left=e.pageX+10+"px",n.appendChild(r)},e.onmousemove=function(e){var t=d("csscritic_basichtmlreporter_tooltip");t.style.top=e.pageY+10+"px",t.style.left=e.pageX+10+"px"},e.onmouseout=function(){var e=d("csscritic_basichtmlreporter_tooltip");e.style.display="none"}},g=function(e){var n=t.createElement("div");return n.className="comparison "+e.status,n.appendChild(p(e)),n.appendChild(h(e)),e.erroneousPageUrls&&n.appendChild(f(e)),e.status==="failed"?(n.appendChild(c(e)),n.appendChild(i(e,!0)),n.appendChild(s(e)),n.appendChild(a(e))):e.status==="referenceMissing"?(n.appendChild(u(e)),n.appendChild(i(e))):e.status==="error"?n.appendChild(l(e)):e.status==="passed"&&m(n,e),n},y=function(e){var t=g(e),n=r();n.appendChild(t)};return e.BasicHTMLReporter=function(){return{reportComparison:y}},e}(window.csscritic||{},window.document);