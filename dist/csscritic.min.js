/*! CSS critic - v0.1.0 - 2012-09-07
* http://www.github.com/cburgmer/csscritic
* Copyright (c) 2012 Christoph Burgmer; Licensed MIT */
var csscritic=function(){var e={},t=[];e.util={};var n=function(e){var t=!1;return e.forEach(function(e){e.resourceType==="page"&&(t=!0)}),t};e.util.drawPageUrl=function(e,t,r,i,s,o){t.width=r,t.height=i,t.getContext("2d").clearRect(0,0,r,i),rasterizeHTML.drawURL(e,t,function(e,t){t!==undefined&&n(t)?o&&o():s&&s()})},e.util.getCanvasForPageUrl=function(t,n,r,i,s){var o=window.document.createElement("canvas");e.util.drawPageUrl(t,o,n,r,function(){i(o)},s)},e.util.getImageForUrl=function(e,t,n){var r=new window.Image;r.onload=function(){t(r)},n&&(r.onerror=n),r.src=e},e.util.getCanvasForImageData=function(e){var t=window.document.createElement("canvas"),n;return t.height=e.height,t.width=e.width,n=t.getContext("2d"),n.putImageData(e,0,0),t};var r=function(n,r,i,s,o){var u,a={status:n,pageUrl:r,pageCanvas:i,referenceUrl:s,referenceImage:o};if(!t.length)return;i&&(a.resizePageCanvas=function(t,n,s){e.util.drawPageUrl(r,i,t,n,s)}),n==="failed"&&(a.differenceImageData=imagediff.diff(i,o));for(u=0;u<t.length;u++)t[u].reportComparison(a)};e.addReporter=function(e){t.push(e)},e.clearReporters=function(){t=[]},e.referencePath=null;var i=function(t){return e.referencePath?/\/$/.test(e.referencePath)?e.referencePath+t:e.referencePath+"/"+t:t},s=function(e){var t=e;return e.substr(-5)===".html"&&(t=e.substr(0,e.length-5)),t+="_reference.png",t},o=function(e,t,n){var r={pageUrl:e,referenceImageUrl:s(e),callback:null};return typeof n=="undefined"&&typeof t=="function"?r.callback=t:(typeof t!="undefined"&&(r.referenceImageUrl=t),typeof n!="undefined"&&(r.callback=n)),r},u=function(e){var t="error";e.callback&&e.callback(t),r(t,e.pageUrl,null,e.referenceImageUrl)};return e.compare=function(t,n,s){var a=o(t,n,s),f=i(a.referenceImageUrl);e.util.getImageForUrl(f,function(t){e.util.getCanvasForPageUrl(a.pageUrl,t.width,t.height,function(e){var n=imagediff.equal(e,t),i=n?"passed":"failed";a.callback&&a.callback(i),r(i,a.pageUrl,e,f,t)},function(){u(a)})},function(){e.util.getCanvasForPageUrl(a.pageUrl,800,600,function(e){var t="referenceMissing";a.callback&&a.callback(t),r(t,a.pageUrl,e,f)},function(){u(a)})})},e}();csscritic.BasicHTMLReporter=function(){var e={},t=null,n=function(e,t){var n=e.style.width,r=e.style.height;e.onmouseup=function(){if(n!==e.style.width||r!==e.style.height)n=e.style.width,r=e.style.height,t(n,r)}},r=function(){t===null&&(t=window.document.createElement("div"),t.id="csscritic_basichtmlreporter",window.document.getElementsByTagName("body")[0].appendChild(t))},i=function(e,t){var r=window.document.createElement("div"),i=window.document.createElement("div"),s=window.document.createElement("div"),o;return i.className="pageCanvasContainer",i.style.width=e.pageCanvas.width+"px",i.style.height=e.pageCanvas.height+"px",t&&(o=window.document.createElement("span"),o.className="caption",o.textContent="Page",r.appendChild(o)),s.className="innerPageCanvasContainer",s.appendChild(e.pageCanvas),i.appendChild(s),n(i,function(){var t=parseInt(i.style.width,10),n=parseInt(i.style.height,10);e.resizePageCanvas(t,n)}),r.className="outerPageCanvasContainer",r.appendChild(i),r},s=function(e){var t=window.document.createElement("div"),n=window.document.createElement("div"),r=window.document.createElement("span");return n.className="referenceImageContainer",n.appendChild(e.referenceImage),r.className="caption",r.textContent="Reference",t.className="outerReferenceImageContainer",t.appendChild(r),t.appendChild(n),t},o=function(e){var t=window.document.createElement("div");return t.className="saveHint warning",t.textContent="To create the future reference please right click on the rendered page and save it under '"+e.referenceUrl+"' relative to this document.",t},u=function(e){var t=window.document.createElement("div");return t.className="updateHint warning",t.textContent="You can update the reference (thus overwriting the current one) by saving the rendered page under '"+e.referenceUrl+"' relative to this document.",t},a=function(e){var t=window.document.createElement("div");return t.className="errorMsg warning",t.textContent="The page '"+e.pageUrl+"' could not be read. Make sure the path lies within the same origin as this document.",t},f=function(e){var t=window.document.createElement("div");return t.className="differenceCanvasContainer",t.appendChild(csscritic.util.getCanvasForImageData(e.differenceImageData)),t},l=function(e){var t=window.document.createElement("span");return t.className="status",e.status==="passed"?t.textContent="passed":e.status==="failed"?t.textContent="failed":e.status==="referenceMissing"?t.textContent="missing reference":e.status==="error"&&(t.textContent="error"),t},c=function(e){var t=window.document.createElement("span");return t.className="pageUrl",t.textContent=e.pageUrl,t},h=function(e){var t=window.document.createElement("div");return t.className="comparison "+e.status,t.appendChild(c(e)),t.appendChild(l(e)),e.status==="failed"?(t.appendChild(f(e)),t.appendChild(i(e,!0)),t.appendChild(s(e)),t.appendChild(u(e))):e.status==="referenceMissing"?(t.appendChild(o(e)),t.appendChild(i(e))):e.status==="error"&&t.appendChild(a(e)),t};return e.reportComparison=function(e){var n=h(e);r(),t.appendChild(n)},e};