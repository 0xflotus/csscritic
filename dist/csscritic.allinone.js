/*! CSS critic - v0.1.0 - 2013-10-17
* http://www.github.com/cburgmer/csscritic
* Copyright (c) 2013 Christoph Burgmer, Copyright (c) 2012 ThoughtWorks, Inc.; Licensed MIT */
/* Integrated dependencies:
 * URI.js (MIT License/GPL v3),
 * cssParser.js (MPL 1.1/GPL 2.0/LGPL 2.1),
 * htmlparser.js,
 * imagediff.js (MIT License),
 * rasterizeHTML.js (MIT License) */
var CSSOM={};CSSOM.CSSStyleDeclaration=function(){this.length=0,this.parentRule=null,this._importants={}},CSSOM.CSSStyleDeclaration.prototype={constructor:CSSOM.CSSStyleDeclaration,getPropertyValue:function(a){return this[a]||""},setProperty:function(a,b,c){if(this[a]){var d=Array.prototype.indexOf.call(this,a);0>d&&(this[this.length]=a,this.length++)}else this[this.length]=a,this.length++;this[a]=b,this._importants[a]=c},removeProperty:function(a){if(a in this){var b=Array.prototype.indexOf.call(this,a);if(0>b)return"";var c=this[a];return this[a]="",Array.prototype.splice.call(this,b,1),c}return""},getPropertyCSSValue:function(){},getPropertyPriority:function(a){return this._importants[a]||""},getPropertyShorthand:function(){},isPropertyImplicit:function(){},get cssText(){for(var a=[],b=0,c=this.length;c>b;++b){var d=this[b],e=this.getPropertyValue(d),f=this.getPropertyPriority(d);f&&(f=" !"+f),a[b]=d+": "+e+f+";"}return a.join(" ")},set cssText(a){var b,c;for(b=this.length;b--;)c=this[b],this[c]="";Array.prototype.splice.call(this,0,this.length),this._importants={};var d=CSSOM.parse("#bogus{"+a+"}").cssRules[0].style,e=d.length;for(b=0;e>b;++b)c=d[b],this.setProperty(d[b],d.getPropertyValue(c),d.getPropertyPriority(c))}},CSSOM.CSSRule=function(){this.parentRule=null,this.parentStyleSheet=null},CSSOM.CSSRule.STYLE_RULE=1,CSSOM.CSSRule.IMPORT_RULE=3,CSSOM.CSSRule.MEDIA_RULE=4,CSSOM.CSSRule.FONT_FACE_RULE=5,CSSOM.CSSRule.PAGE_RULE=6,CSSOM.CSSRule.WEBKIT_KEYFRAMES_RULE=8,CSSOM.CSSRule.WEBKIT_KEYFRAME_RULE=9,CSSOM.CSSRule.prototype={constructor:CSSOM.CSSRule},CSSOM.CSSStyleRule=function(){CSSOM.CSSRule.call(this),this.selectorText="",this.style=new CSSOM.CSSStyleDeclaration,this.style.parentRule=this},CSSOM.CSSStyleRule.prototype=new CSSOM.CSSRule,CSSOM.CSSStyleRule.prototype.constructor=CSSOM.CSSStyleRule,CSSOM.CSSStyleRule.prototype.type=1,CSSOM.CSSStyleRule.prototype.__defineGetter__("cssText",function(){var a;return a=this.selectorText?this.selectorText+" {"+this.style.cssText+"}":""}),CSSOM.CSSStyleRule.prototype.__defineSetter__("cssText",function(a){var b=CSSOM.CSSStyleRule.parse(a);this.style=b.style,this.selectorText=b.selectorText}),CSSOM.CSSStyleRule.parse=function(a){for(var b,c,d,e=0,f="selector",g=e,h="",i={selector:!0,value:!0},j=new CSSOM.CSSStyleRule,k="";d=a.charAt(e);e++)switch(d){case" ":case"	":case"\r":case"\n":case"\f":if(i[f])switch(a.charAt(e-1)){case" ":case"	":case"\r":case"\n":case"\f":break;default:h+=" "}break;case'"':if(g=e+1,b=a.indexOf('"',g)+1,!b)throw'" is missing';h+=a.slice(e,b),e=b-1;break;case"'":if(g=e+1,b=a.indexOf("'",g)+1,!b)throw"' is missing";h+=a.slice(e,b),e=b-1;break;case"/":if("*"===a.charAt(e+1)){if(e+=2,b=a.indexOf("*/",e),-1===b)throw new SyntaxError("Missing */");e=b+1}else h+=d;break;case"{":"selector"===f&&(j.selectorText=h.trim(),h="",f="name");break;case":":"name"===f?(c=h.trim(),h="",f="value"):h+=d;break;case"!":"value"===f&&a.indexOf("!important",e)===e?(k="important",e+="important".length):h+=d;break;case";":"value"===f?(j.style.setProperty(c,h.trim(),k),k="",h="",f="name"):h+=d;break;case"}":if("value"===f)j.style.setProperty(c,h.trim(),k),k="",h="";else{if("name"===f)break;h+=d}f="selector";break;default:h+=d}return j},CSSOM.MediaList=function(){this.length=0},CSSOM.MediaList.prototype={constructor:CSSOM.MediaList,get mediaText(){return Array.prototype.join.call(this,", ")},set mediaText(a){for(var b=a.split(","),c=this.length=b.length,d=0;c>d;d++)this[d]=b[d].trim()},appendMedium:function(a){-1===Array.prototype.indexOf.call(this,a)&&(this[this.length]=a,this.length++)},deleteMedium:function(a){var b=Array.prototype.indexOf.call(this,a);-1!==b&&Array.prototype.splice.call(this,b,1)}},CSSOM.CSSMediaRule=function(){CSSOM.CSSRule.call(this),this.media=new CSSOM.MediaList,this.cssRules=[]},CSSOM.CSSMediaRule.prototype=new CSSOM.CSSRule,CSSOM.CSSMediaRule.prototype.constructor=CSSOM.CSSMediaRule,CSSOM.CSSMediaRule.prototype.type=4,CSSOM.CSSMediaRule.prototype.__defineGetter__("cssText",function(){for(var a=[],b=0,c=this.cssRules.length;c>b;b++)a.push(this.cssRules[b].cssText);return"@media "+this.media.mediaText+" {"+a.join("")+"}"}),CSSOM.CSSImportRule=function(){CSSOM.CSSRule.call(this),this.href="",this.media=new CSSOM.MediaList,this.styleSheet=new CSSOM.CSSStyleSheet},CSSOM.CSSImportRule.prototype=new CSSOM.CSSRule,CSSOM.CSSImportRule.prototype.constructor=CSSOM.CSSImportRule,CSSOM.CSSImportRule.prototype.type=3,CSSOM.CSSImportRule.prototype.__defineGetter__("cssText",function(){var a=this.media.mediaText;return"@import url("+this.href+")"+(a?" "+a:"")+";"}),CSSOM.CSSImportRule.prototype.__defineSetter__("cssText",function(a){for(var b,c,d=0,e="",f="";c=a.charAt(d);d++)switch(c){case" ":case"	":case"\r":case"\n":case"\f":"after-import"===e?e="url":f+=c;break;case"@":!e&&a.indexOf("@import",d)===d&&(e="after-import",d+="import".length,f="");break;case"u":if("url"===e&&a.indexOf("url(",d)===d){if(b=a.indexOf(")",d+1),-1===b)throw d+': ")" not found';d+="url(".length;var g=a.slice(d,b);g[0]===g[g.length-1]&&('"'===g[0]||"'"===g[0])&&(g=g.slice(1,-1)),this.href=g,d=b,e="media"}break;case'"':if("url"===e){if(b=a.indexOf('"',d+1),!b)throw d+": '\"' not found";this.href=a.slice(d+1,b),d=b,e="media"}break;case"'":if("url"===e){if(b=a.indexOf("'",d+1),!b)throw d+': "\'" not found';this.href=a.slice(d+1,b),d=b,e="media"}break;case";":"media"===e&&f&&(this.media.mediaText=f.trim());break;default:"media"===e&&(f+=c)}}),CSSOM.CSSFontFaceRule=function(){CSSOM.CSSRule.call(this),this.style=new CSSOM.CSSStyleDeclaration,this.style.parentRule=this},CSSOM.CSSFontFaceRule.prototype=new CSSOM.CSSRule,CSSOM.CSSFontFaceRule.prototype.constructor=CSSOM.CSSFontFaceRule,CSSOM.CSSFontFaceRule.prototype.type=5,CSSOM.CSSFontFaceRule.prototype.__defineGetter__("cssText",function(){return"@font-face {"+this.style.cssText+"}"}),CSSOM.StyleSheet=function(){this.parentStyleSheet=null},CSSOM.CSSStyleSheet=function(){CSSOM.StyleSheet.call(this),this.cssRules=[]},CSSOM.CSSStyleSheet.prototype=new CSSOM.StyleSheet,CSSOM.CSSStyleSheet.prototype.constructor=CSSOM.CSSStyleSheet,CSSOM.CSSStyleSheet.prototype.insertRule=function(a,b){if(0>b||b>this.cssRules.length)throw new RangeError("INDEX_SIZE_ERR");var c=CSSOM.parse(a).cssRules[0];return this.cssRules.splice(b,0,c),b},CSSOM.CSSStyleSheet.prototype.deleteRule=function(a){if(0>a||a>=this.cssRules.length)throw new RangeError("INDEX_SIZE_ERR");this.cssRules.splice(a,1)},CSSOM.CSSStyleSheet.prototype.toString=function(){for(var a="",b=this.cssRules,c=0;c<b.length;c++)a+=b[c].cssText+"\n";return a},CSSOM.CSSKeyframesRule=function(){CSSOM.CSSRule.call(this),this.name="",this.cssRules=[]},CSSOM.CSSKeyframesRule.prototype=new CSSOM.CSSRule,CSSOM.CSSKeyframesRule.prototype.constructor=CSSOM.CSSKeyframesRule,CSSOM.CSSKeyframesRule.prototype.type=8,CSSOM.CSSKeyframesRule.prototype.__defineGetter__("cssText",function(){for(var a=[],b=0,c=this.cssRules.length;c>b;b++)a.push("  "+this.cssRules[b].cssText);return"@"+(this._vendorPrefix||"")+"keyframes "+this.name+" { \n"+a.join("\n")+"\n}"}),CSSOM.CSSKeyframeRule=function(){CSSOM.CSSRule.call(this),this.keyText="",this.style=new CSSOM.CSSStyleDeclaration,this.style.parentRule=this},CSSOM.CSSKeyframeRule.prototype=new CSSOM.CSSRule,CSSOM.CSSKeyframeRule.prototype.constructor=CSSOM.CSSKeyframeRule,CSSOM.CSSKeyframeRule.prototype.type=9,CSSOM.CSSKeyframeRule.prototype.__defineGetter__("cssText",function(){return this.keyText+" {"+this.style.cssText+"} "}),CSSOM.MatcherList=function(){this.length=0},CSSOM.MatcherList.prototype={constructor:CSSOM.MatcherList,get matcherText(){return Array.prototype.join.call(this,", ")},set matcherText(a){for(var b=a.split(","),c=this.length=b.length,d=0;c>d;d++)this[d]=b[d].trim()},appendMatcher:function(a){-1===Array.prototype.indexOf.call(this,a)&&(this[this.length]=a,this.length++)},deleteMatcher:function(a){var b=Array.prototype.indexOf.call(this,a);-1!==b&&Array.prototype.splice.call(this,b,1)}},CSSOM.CSSDocumentRule=function(){CSSOM.CSSRule.call(this),this.matcher=new CSSOM.MatcherList,this.cssRules=[]},CSSOM.CSSDocumentRule.prototype=new CSSOM.CSSRule,CSSOM.CSSDocumentRule.prototype.constructor=CSSOM.CSSDocumentRule,CSSOM.CSSDocumentRule.prototype.type=10,CSSOM.CSSDocumentRule.prototype.__defineGetter__("cssText",function(){for(var a=[],b=0,c=this.cssRules.length;c>b;b++)a.push(this.cssRules[b].cssText);return"@-moz-document "+this.matcher.matcherText+" {"+a.join("")+"}"}),CSSOM.CSSValue=function(){},CSSOM.CSSValue.prototype={constructor:CSSOM.CSSValue,set cssText(a){var b=this._getConstructorName();throw new Exception('DOMException: property "cssText" of "'+b+'" is readonly!')},get cssText(){var a=this._getConstructorName();throw new Exception('getter "cssText" of "'+a+'" is not implemented!')},_getConstructorName:function(){var a=this.constructor.toString(),b=a.match(/function\s([^\(]+)/),c=b[1];return c}},CSSOM.CSSValueExpression=function(a,b){this._token=a,this._idx=b},CSSOM.CSSValueExpression.prototype=new CSSOM.CSSValue,CSSOM.CSSValueExpression.prototype.constructor=CSSOM.CSSValueExpression,CSSOM.CSSValueExpression.prototype.parse=function(){for(var a,b=this._token,c=this._idx,d="",e="",f="",g=[];;++c){if(d=b.charAt(c),""==d){f="css expression error: unfinished expression!";break}switch(d){case"(":g.push(d),e+=d;break;case")":g.pop(d),e+=d;break;case"/":(a=this._parseJSComment(b,c))?a.error?f="css expression error: unfinished comment in expression!":c=a.idx:(a=this._parseJSRexExp(b,c))?(c=a.idx,e+=a.text):e+=d;break;case"'":case'"':a=this._parseJSString(b,c,d),a?(c=a.idx,e+=a.text):e+=d;break;default:e+=d}if(f)break;if(0==g.length)break}var h;return h=f?{error:f}:{idx:c,expression:e}},CSSOM.CSSValueExpression.prototype._parseJSComment=function(a,b){var c,d=a.charAt(b+1);if("/"==d||"*"==d){var e,f,g=b;return"/"==d?f="\n":"*"==d&&(f="*/"),e=a.indexOf(f,g+1+1),-1!==e?(e=e+f.length-1,c=a.substring(b,e+1),{idx:e,text:c}):(error="css expression error: unfinished comment in expression!",{error:error})}return!1},CSSOM.CSSValueExpression.prototype._parseJSString=function(a,b,c){var d,e=this._findMatchedIdx(a,b,c);return-1===e?!1:(d=a.substring(b,e+c.length),{idx:e,text:d})},CSSOM.CSSValueExpression.prototype._parseJSRexExp=function(a,b){var c=a.substring(0,b).trimRight(),d=[/^$/,/\($/,/\[$/,/\!$/,/\+$/,/\-$/,/\*$/,/\/\s+/,/\%$/,/\=$/,/\>$/,/\<$/,/\&$/,/\|$/,/\^$/,/\~$/,/\?$/,/\,$/,/delete$/,/in$/,/instanceof$/,/new$/,/typeof$/,/void$/],e=d.some(function(a){return a.test(c)});if(!e)return!1;var f="/";return this._parseJSString(a,b,f)},CSSOM.CSSValueExpression.prototype._findMatchedIdx=function(a,b,c){for(var d,e=b,f=-1;;){if(d=a.indexOf(c,e+1),-1===d){d=f;break}var g=a.substring(b+1,d),h=g.match(/\\+$/);if(!h||0==h[0]%2)break;e=d}var i=a.indexOf("\n",b+1);return d>i&&(d=f),d},CSSOM.parse=function(a){for(var b,c,d,e,f,g,h,i,j,k,l=0,m="before-selector",n="",o={selector:!0,value:!0,atRule:!0,"importRule-begin":!0,importRule:!0,atBlock:!0,"documentRule-begin":!0},p=new CSSOM.CSSStyleSheet,q=p,r="",s=/@(-(?:\w+-)+)?keyframes/g,t=function(b){var c=a.substring(0,l).split("\n"),d=c.length,e=c.pop().length+1,f=new Error(b+" (line "+d+", char "+e+")");throw f.line=d,f.char=e,f.styleSheet=p,f};k=a.charAt(l);l++)switch(k){case" ":case"	":case"\r":case"\n":case"\f":o[m]&&(n+=k);break;case'"':b=l+1;do b=a.indexOf('"',b)+1,b||t('Unmatched "');while("\\"===a[b-2]);switch(n+=a.slice(l,b),l=b-1,m){case"before-value":m="value";break;case"importRule-begin":m="importRule"}break;case"'":b=l+1;do b=a.indexOf("'",b)+1,b||t("Unmatched '");while("\\"===a[b-2]);switch(n+=a.slice(l,b),l=b-1,m){case"before-value":m="value";break;case"importRule-begin":m="importRule"}break;case"/":"*"===a.charAt(l+1)?(l+=2,b=a.indexOf("*/",l),-1===b?t("Missing */"):l=b+1):n+=k,"importRule-begin"===m&&(n+=" ",m="importRule");break;case"@":if(a.indexOf("@-moz-document",l)===l){m="documentRule-begin",j=new CSSOM.CSSDocumentRule,j.__starts=l,l+="-moz-document".length,n="";break}if(a.indexOf("@media",l)===l){m="atBlock",f=new CSSOM.CSSMediaRule,f.__starts=l,l+="media".length,n="";break}if(a.indexOf("@import",l)===l){m="importRule-begin",l+="import".length,n+="@import";break}if(a.indexOf("@font-face",l)===l){m="fontFaceRule-begin",l+="font-face".length,h=new CSSOM.CSSFontFaceRule,h.__starts=l,n="";break}s.lastIndex=l;var u=s.exec(a);if(u&&u.index===l){m="keyframesRule-begin",i=new CSSOM.CSSKeyframesRule,i.__starts=l,i._vendorPrefix=u[1],l+=u[0].length-1,n="";break}"selector"==m&&(m="atRule"),n+=k;break;case"{":"selector"===m||"atRule"===m?(e.selectorText=n.trim(),e.style.__starts=l,n="",m="before-name"):"atBlock"===m?(f.media.mediaText=n.trim(),q=c=f,f.parentStyleSheet=p,n="",m="before-selector"):"fontFaceRule-begin"===m?(c&&(h.parentRule=c),h.parentStyleSheet=p,e=h,n="",m="before-name"):"keyframesRule-begin"===m?(i.name=n.trim(),c&&(i.parentRule=c),i.parentStyleSheet=p,q=c=i,n="",m="keyframeRule-begin"):"keyframeRule-begin"===m?(e=new CSSOM.CSSKeyframeRule,e.keyText=n.trim(),e.__starts=l,n="",m="before-name"):"documentRule-begin"===m&&(j.matcher.matcherText=n.trim(),c&&(j.parentRule=c),q=c=j,j.parentStyleSheet=p,n="",m="before-selector");break;case":":"name"===m?(d=n.trim(),n="",m="before-value"):n+=k;break;case"(":if("value"===m)if("expression"==n.trim()){var v=new CSSOM.CSSValueExpression(a,l).parse();v.error?t(v.error):(n+=v.expression,l=v.idx)}else b=a.indexOf(")",l+1),-1===b&&t('Unmatched "("'),n+=a.slice(l,b+1),l=b;else n+=k;break;case"!":"value"===m&&a.indexOf("!important",l)===l?(r="important",l+="important".length):n+=k;break;case";":switch(m){case"value":e.style.setProperty(d,n.trim(),r),r="",n="",m="before-name";break;case"atRule":n="",m="before-selector";break;case"importRule":g=new CSSOM.CSSImportRule,g.parentStyleSheet=g.styleSheet.parentStyleSheet=p,g.cssText=n+k,p.cssRules.push(g),n="",m="before-selector";break;default:n+=k}break;case"}":switch(m){case"value":e.style.setProperty(d,n.trim(),r),r="";case"before-name":case"name":e.__ends=l+1,c&&(e.parentRule=c),e.parentStyleSheet=p,q.cssRules.push(e),n="",m=q.constructor===CSSOM.CSSKeyframesRule?"keyframeRule-begin":"before-selector";break;case"keyframeRule-begin":case"before-selector":case"selector":c||t("Unexpected }"),q.__ends=l+1,p.cssRules.push(q),q=p,c=null,n="",m="before-selector"}break;default:switch(m){case"before-selector":m="selector",e=new CSSOM.CSSStyleRule,e.__starts=l;break;case"before-name":m="name";break;case"before-value":m="value";break;case"importRule-begin":m="importRule"}n+=k}return p},CSSOM.clone=function a(b){var c=new CSSOM.CSSStyleSheet,d=b.cssRules;if(!d)return c;for(var e={1:CSSOM.CSSStyleRule,4:CSSOM.CSSMediaRule,8:CSSOM.CSSKeyframesRule,9:CSSOM.CSSKeyframeRule},f=0,g=d.length;g>f;f++){var h=d[f],i=c.cssRules[f]=new e[h.type],j=h.style;if(j){for(var k=i.style=new CSSOM.CSSStyleDeclaration,l=0,m=j.length;m>l;l++){var n=k[l]=j[l];k[n]=j[n],k._importants[n]=j.getPropertyPriority(n)}k.length=j.length}h.hasOwnProperty("keyText")&&(i.keyText=h.keyText),h.hasOwnProperty("selectorText")&&(i.selectorText=h.selectorText),h.hasOwnProperty("mediaText")&&(i.mediaText=h.mediaText),h.hasOwnProperty("cssRules")&&(i.cssRules=a(h).cssRules)}return c},function(){function a(a){for(var b={},c=a.split(","),d=0;d<c.length;d++)b[c[d]]=!0;return b}var b=/^<([-A-Za-z0-9_]+)((?:\s+[-A-Za-z0-9_]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,c=/^<\/([-A-Za-z0-9_]+)[^>]*>/,d=/([-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,e=a("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),f=a("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul"),g=a("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),h=a("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),i=a("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),j=a("script,style"),k=this.HTMLParser=function(a,k){function l(a,b,c,j){if(b=b.toLowerCase(),f[b])for(;q.last()&&g[q.last()];)m("",q.last());if(h[b]&&q.last()==b&&m("",b),j=e[b]||!!j,j||q.push(b),k.start){var l=[];c.replace(d,function(a,b){var c=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:i[b]?b:"";l.push({name:b,value:c,escaped:c.replace(/(^|[^\\])"/g,'$1\\"')})}),k.start&&k.start(b,l,j)}}function m(a,b){if(b)for(var c=q.length-1;c>=0&&q[c]!=b;c--);else var c=0;if(c>=0){for(var d=q.length-1;d>=c;d--)k.end&&k.end(q[d]);q.length=c}}var n,o,p,q=[],r=a;for(q.last=function(){return this[this.length-1]};a;){if(o=!0,q.last()&&j[q.last()])a=a.replace(new RegExp("^((?:.|\n)*?)</"+q.last()+"[^>]*>"),function(a,b){return b=b.replace(/<!--(.*?)-->/g,"$1").replace(/<!\[CDATA\[(.*?)]]>/g,"$1"),k.chars&&k.chars(b),""}),m("",q.last());else if(0==a.indexOf("<!--")?(n=a.indexOf("-->"),n>=0&&(k.comment&&k.comment(a.substring(4,n)),a=a.substring(n+3),o=!1)):0==a.indexOf("</")?(p=a.match(c),p&&(a=a.substring(p[0].length),p[0].replace(c,m),o=!1)):0==a.indexOf("<")&&(p=a.match(b),p&&(a=a.substring(p[0].length),p[0].replace(b,l),o=!1)),o){n=a.indexOf("<");var s=0>n?a:a.substring(0,n);a=0>n?"":a.substring(n),k.chars&&k.chars(s)}if(a==r)throw"Parse Error: "+a;r=a}m()};this.HTMLtoXML=function(a){var b="";return k(a,{start:function(a,c,d){b+="<"+a;for(var e=0;e<c.length;e++)b+=" "+c[e].name+'="'+c[e].escaped+'"';b+=(d?"/":"")+">",j[a]&&(b+="<![CDATA[\n")},end:function(a){j[a]&&(b+="\n]]>"),b+="</"+a+">"},chars:function(a){b+=a},comment:function(a){b+="<!--"+a+"-->"}}),b},this.HTMLtoDOM=function(b,c){var d=a("html,head,body,title"),e={link:"head",base:"head"};c?c=c.ownerDocument||c.getOwnerDocument&&c.getOwnerDocument()||c:"undefined"!=typeof DOMDocument?c=new DOMDocument:"undefined"!=typeof document&&document.implementation&&document.implementation.createDocument?c=document.implementation.createDocument("","",null):"undefined"!=typeof ActiveX&&(c=new ActiveXObject("Msxml.DOMDocument"));var f=[],g=c.documentElement||c.getDocumentElement&&c.getDocumentElement();if(!g&&c.createElement&&function(){var a=c.createElement("html"),b=c.createElement("head");b.appendChild(c.createElement("title")),a.appendChild(b),a.appendChild(c.createElement("body")),c.appendChild(a)}(),c.getElementsByTagName)for(var h in d)d[h]=c.getElementsByTagName(h)[0];var i=d.body;return k(b,{start:function(a,b,g){if(d[a])return i=d[a],void 0;var h=c.createElement(a);for(var j in b)h.setAttribute(b[j].name,b[j].value);e[a]&&"boolean"!=typeof d[e[a]]?d[e[a]].appendChild(h):i&&i.appendChild&&i.appendChild(h),g||(f.push(h),i=h)},end:function(){f.length-=1,i=f[f.length-1]},chars:function(a){i.appendChild(c.createTextNode(a))},comment:function(){}}),c}}(),function(a){function b(a){return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function c(a){return"[object Array]"===String(Object.prototype.toString.call(a))}function d(b,d){var e,f,g={};if(c(d))for(e=0,f=d.length;f>e;e++)g[d[e]]=!0;else g[d]=!0;for(e=0,f=b.length;f>e;e++)g[b[e]]!==a&&(b.splice(e,1),f--,e--);return b}var e="undefined"!=typeof module&&module.exports,f=function(a){return e?require("./"+a):window[a]},g=f("punycode"),h=f("IPv6"),i=f("SecondLevelDomains"),j=function(b,c){return this instanceof j?(b===a&&(b=location.href+""),this.href(b),c!==a?this.absoluteTo(c):this):new j(b)},k=j.prototype;j.idn_expression=/[^a-z0-9\.-]/i,j.punycode_expression=/(xn--)/i,j.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,j.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,j.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,j.defaultPorts={http:"80",https:"443",ftp:"21"},j.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,j.encode=encodeURIComponent,j.decode=decodeURIComponent,j.iso8859=function(){j.encode=escape,j.decode=unescape},j.unicode=function(){j.encode=encodeURIComponent,j.decode=decodeURIComponent},j.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}}},j.encodeQuery=function(a){return j.encode(a+"").replace(/%20/g,"+")},j.decodeQuery=function(a){return j.decode((a+"").replace(/\+/g,"%20"))},j.recodePath=function(a){for(var b=(a+"").split("/"),c=0,d=b.length;d>c;c++)b[c]=j.encodePathSegment(j.decode(b[c]));return b.join("/")},j.decodePath=function(a){for(var b=(a+"").split("/"),c=0,d=b.length;d>c;c++)b[c]=j.decodePathSegment(b[c]);return b.join("/")};var l,m={encode:"encode",decode:"decode"},n=function(a){return function(b){return j[a](b+"").replace(j.characters.pathname[a].expression,function(b){return j.characters.pathname[a].map[b]})}};for(l in m)j[l+"PathSegment"]=n(m[l]);j.parse=function(a){var b,c={};return b=a.indexOf("#"),b>-1&&(c.fragment=a.substring(b+1)||null,a=a.substring(0,b)),b=a.indexOf("?"),b>-1&&(c.query=a.substring(b+1)||null,a=a.substring(0,b)),"//"===a.substring(0,2)?(c.protocol="",a=a.substring(2),a=j.parseAuthority(a,c)):(b=a.indexOf(":"),b>-1&&(c.protocol=a.substring(0,b),"//"===a.substring(b+1,b+3)?(a=a.substring(b+3),a=j.parseAuthority(a,c)):(a=a.substring(b+1),c.urn=!0))),c.path=a,c},j.parseHost=function(a,b){var c,d=a.indexOf("/");if(-1===d&&(d=a.length),"["===a[0]){var e=a.indexOf("]");b.hostname=a.substring(1,e)||null,b.port=a.substring(e+2,d)||null}else a.indexOf(":")!==a.lastIndexOf(":")?(b.hostname=a.substring(0,d)||null,b.port=null):(c=a.substring(0,d).split(":"),b.hostname=c[0]||null,b.port=c[1]||null);return b.hostname&&"/"!==a.substring(d)[0]&&(d++,a="/"+a),a.substring(d)||"/"},j.parseAuthority=function(a,b){return a=j.parseUserinfo(a,b),j.parseHost(a,b)},j.parseUserinfo=function(a,b){var c,d=a.indexOf("@"),e=a.indexOf("/");return d>-1&&(-1===e||e>d)?(c=a.substring(0,d).split(":"),b.username=c[0]?j.decode(c[0]):null,b.password=c[1]?j.decode(c[1]):null,a=a.substring(d+1)):(b.username=null,b.password=null),a},j.parseQuery=function(a){if(!a)return{};if(a=a.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!a)return{};for(var b={},c=a.split("&"),d=c.length,e=0;d>e;e++){var f=c[e].split("="),g=j.decodeQuery(f.shift()),h=f.length?j.decodeQuery(f.join("=")):null;b[g]?("string"==typeof b[g]&&(b[g]=[b[g]]),b[g].push(h)):b[g]=h}return b},j.build=function(a){var b="";return a.protocol&&(b+=a.protocol+":"),!a.urn&&(b||a.hostname)&&(b+="//"),b+=j.buildAuthority(a)||"","string"==typeof a.path&&("/"!==a.path[0]&&"string"==typeof a.hostname&&(b+="/"),b+=a.path),"string"==typeof a.query&&(b+="?"+a.query),"string"==typeof a.fragment&&(b+="#"+a.fragment),b},j.buildHost=function(a){var b="";return a.hostname?(j.ip6_expression.test(a.hostname)?b+=a.port?"["+a.hostname+"]:"+a.port:a.hostname:(b+=a.hostname,a.port&&(b+=":"+a.port)),b):""},j.buildAuthority=function(a){return j.buildUserinfo(a)+j.buildHost(a)},j.buildUserinfo=function(a){var b="";return a.username&&(b+=j.encode(a.username),a.password&&(b+=":"+j.encode(a.password)),b+="@"),b},j.buildQuery=function(b,d){var e="";for(var f in b)if(Object.hasOwnProperty.call(b,f)&&f)if(c(b[f]))for(var g={},h=0,i=b[f].length;i>h;h++)b[f][h]!==a&&g[b[f][h]+""]===a&&(e+="&"+j.buildQueryParameter(f,b[f][h]),d!==!0&&(g[b[f][h]+""]=!0));else b[f]!==a&&(e+="&"+j.buildQueryParameter(f,b[f]));return e.substring(1)},j.buildQueryParameter=function(a,b){return j.encodeQuery(a)+(null!==b?"="+j.encodeQuery(b):"")},j.addQuery=function(b,d,e){if("object"==typeof d)for(var f in d)Object.prototype.hasOwnProperty.call(d,f)&&j.addQuery(b,f,d[f]);else{if("string"!=typeof d)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(b[d]===a)return b[d]=e,void 0;"string"==typeof b[d]&&(b[d]=[b[d]]),c(e)||(e=[e]),b[d]=b[d].concat(e)}},j.removeQuery=function(b,e,f){if(c(e))for(var g=0,h=e.length;h>g;g++)b[e[g]]=a;else if("object"==typeof e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&j.removeQuery(b,i,e[i]);else{if("string"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the first parameter");f!==a?b[e]===f?b[e]=a:c(b[e])&&(b[e]=d(b[e],f)):b[e]=a}},j.commonPath=function(a,b){var c,d=Math.min(a.length,b.length);for(c=0;d>c;c++)if(a[c]!==b[c]){c--;break}return 1>c?a[0]===b[0]&&"/"===a[0]?"/":"":("/"!==a[c]&&(c=a.substring(0,c).lastIndexOf("/")),a.substring(0,c+1))},j.withinString=function(a,b){return a.replace(j.find_uri_expression,b)},j.ensureValidHostname=function(a){if(a.match(j.invalid_hostname_characters)){if(!g)throw new TypeError("Hostname '"+a+"' contains characters other than [A-Z0-9.-] and Punycode.js is not available");if(g.toASCII(a).match(j.invalid_hostname_characters))throw new TypeError("Hostname '"+a+"' contains characters other than [A-Z0-9.-]")}},k.build=function(b){return b===!0?this._deferred_build=!0:(b===a||this._deferred_build)&&(this._string=j.build(this._parts),this._deferred_build=!1),this},k.toString=function(){return this.build(!1)._string},k.valueOf=function(){return this.toString()},m={protocol:"protocol",username:"username",password:"password",hostname:"hostname",port:"port"},n=function(b){return function(c,d){return c===a?this._parts[b]||"":(this._parts[b]=c,this.build(!d),this)}};for(l in m)k[l]=n(m[l]);m={query:"?",fragment:"#"},n=function(b,c){return function(d,e){return d===a?this._parts[b]||"":(null!==d&&(d+="",d[0]===c&&(d=d.substring(1))),this._parts[b]=d,this.build(!e),this)}};for(l in m)k[l]=n(l,m[l]);m={search:["?","query"],hash:["#","fragment"]},n=function(a,b){return function(c,d){var e=this[a](c,d);return"string"==typeof e&&e.length?b+e:e}};for(l in m)k[l]=n(m[l][1],m[l][0]);k.pathname=function(b,c){if(b===a||b===!0){var d=this._parts.path||(this._parts.urn?"":"/");return b?j.decodePath(d):d}return this._parts.path=b?j.recodePath(b):"/",this.build(!c),this},k.path=k.pathname,k.href=function(b,c){if(b===a)return this.toString();this._string="",this._parts={protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null};var d,e=b instanceof j,f="object"==typeof b&&(b.hostname||b.path);if("string"==typeof b)this._parts=j.parse(b);else{if(!e&&!f)throw new TypeError("invalid input");var g=e?b._parts:b;for(d in g)Object.hasOwnProperty.call(this._parts,d)&&(this._parts[d]=g[d])}return this.build(!c),this},k.is=function(a){var b=!1,c=!1,d=!1,e=!1,f=!1,g=!1,h=!1,k=!this._parts.urn;switch(this._parts.hostname&&(k=!1,c=j.ip4_expression.test(this._parts.hostname),d=j.ip6_expression.test(this._parts.hostname),b=c||d,e=!b,f=e&&i&&i.has(this._parts.hostname),g=e&&j.idn_expression.test(this._parts.hostname),h=e&&j.punycode_expression.test(this._parts.hostname)),a.toLowerCase()){case"relative":return k;case"absolute":return!k;case"domain":case"name":return e;case"sld":return f;case"ip":return b;case"ip4":case"ipv4":case"inet4":return c;case"ip6":case"ipv6":case"inet6":return d;case"idn":return g;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return h}return null};var o=k.protocol,p=k.port,q=k.hostname;k.protocol=function(b,c){if(b!==a&&b&&(b=b.replace(/:(\/\/)?$/,""),b.match(/[^a-zA-z0-9\.+-]/)))throw new TypeError("Protocol '"+b+"' contains characters other than [A-Z0-9.+-]");return o.call(this,b,c)},k.scheme=k.protocol,k.port=function(b,c){if(this._parts.urn)return b===a?"":this;if(b!==a&&(0===b&&(b=null),b&&(b+="",":"===b[0]&&(b=b.substring(1)),b.match(/[^0-9]/))))throw new TypeError("Port '"+b+"' contains characters other than [0-9]");return p.call(this,b,c)},k.hostname=function(b,c){if(this._parts.urn)return b===a?"":this;if(b!==a){var d={};j.parseHost(b,d),b=d.hostname}return q.call(this,b,c)},k.host=function(b,c){return this._parts.urn?b===a?"":this:b===a?this._parts.hostname?j.buildHost(this._parts):"":(j.parseHost(b,this._parts),this.build(!c),this)},k.authority=function(b,c){return this._parts.urn?b===a?"":this:b===a?this._parts.hostname?j.buildAuthority(this._parts):"":(j.parseAuthority(b,this._parts),this.build(!c),this)},k.userinfo=function(b,c){if(this._parts.urn)return b===a?"":this;if(b===a){if(!this._parts.username)return"";var d=j.buildUserinfo(this._parts);return d.substring(0,d.length-1)}return"@"!==b[b.length-1]&&(b+="@"),j.parseUserinfo(b,this._parts),this.build(!c),this},k.subdomain=function(c,d){if(this._parts.urn)return c===a?"":this;if(c===a){if(!this._parts.hostname||this.is("IP"))return"";var e=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,e)||""}var f=this._parts.hostname.length-this.domain().length,g=this._parts.hostname.substring(0,f),h=new RegExp("^"+b(g));return c&&"."!==c[c.length-1]&&(c+="."),c&&j.ensureValidHostname(c),this._parts.hostname=this._parts.hostname.replace(h,c),this.build(!d),this},k.domain=function(c,d){if(this._parts.urn)return c===a?"":this;if("boolean"==typeof c&&(d=c,c=a),c===a){if(!this._parts.hostname||this.is("IP"))return"";var e=this._parts.hostname.match(/\./g);if(e&&e.length<2)return this._parts.hostname;var f=this._parts.hostname.length-this.tld(d).length-1;return f=this._parts.hostname.lastIndexOf(".",f-1)+1,this._parts.hostname.substring(f)||""}if(!c)throw new TypeError("cannot set domain empty");if(j.ensureValidHostname(c),!this._parts.hostname||this.is("IP"))this._parts.hostname=c;else{var g=new RegExp(b(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(g,c)}return this.build(!d),this},k.tld=function(c,d){if(this._parts.urn)return c===a?"":this;if("boolean"==typeof c&&(d=c,c=a),c===a){if(!this._parts.hostname||this.is("IP"))return"";var e=this._parts.hostname.lastIndexOf("."),f=this._parts.hostname.substring(e+1);return d!==!0&&i&&i.list[f.toLowerCase()]?i.get(this._parts.hostname)||f:f}var g;if(!c)throw new TypeError("cannot set TLD empty");if(c.match(/[^a-zA-Z0-9-]/)){if(!i||!i.is(c))throw new TypeError("TLD '"+c+"' contains characters other than [A-Z0-9]");g=new RegExp(b(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(g,c)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");g=new RegExp(b(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(g,c)}return this.build(!d),this},k.directory=function(c,d){if(this._parts.urn)return c===a?"":this;if(c===a||c===!0){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var e=this._parts.path.length-this.filename().length-1,f=this._parts.path.substring(0,e)||(this._parts.hostname?"/":"");return c?j.decodePath(f):f}var g=this._parts.path.length-this.filename().length,h=this._parts.path.substring(0,g),i=new RegExp("^"+b(h));return this.is("relative")||(c||(c="/"),"/"!==c[0]&&(c="/"+c)),c&&"/"!==c[c.length-1]&&(c+="/"),c=j.recodePath(c),this._parts.path=this._parts.path.replace(i,c),this.build(!d),this
},k.filename=function(c,d){if(this._parts.urn)return c===a?"":this;if(c===a||c===!0){if(!this._parts.path||"/"===this._parts.path)return"";var e=this._parts.path.lastIndexOf("/"),f=this._parts.path.substring(e+1);return c?j.decodePathSegment(f):f}var g=!1;"/"===c[0]&&(c=c.substring(1)),c.match(/\.?\//)&&(g=!0);var h=new RegExp(b(this.filename())+"$");return c=j.recodePath(c),this._parts.path=this._parts.path.replace(h,c),g?this.normalizePath(d):this.build(!d),this},k.suffix=function(c,d){if(this._parts.urn)return c===a?"":this;if(c===a||c===!0){if(!this._parts.path||"/"===this._parts.path)return"";var e,f,g=this.filename(),h=g.lastIndexOf(".");return-1===h?"":(e=g.substring(h+1),f=/^[a-z0-9%]+$/i.test(e)?e:"",c?j.decodePathSegment(f):f)}"."===c[0]&&(c=c.substring(1));var i,k=this.suffix();if(k)i=c?new RegExp(b(k)+"$"):new RegExp(b("."+k)+"$");else{if(!c)return this;this._parts.path+="."+j.recodePath(c)}return i&&(c=j.recodePath(c),this._parts.path=this._parts.path.replace(i,c)),this.build(!d),this};var r=k.query;k.query=function(b,c){return b===!0?j.parseQuery(this._parts.query):b!==a&&"string"!=typeof b?(this._parts.query=j.buildQuery(b),this.build(!c),this):r.call(this,b,c)},k.addQuery=function(a,b,c){var d=j.parseQuery(this._parts.query);return j.addQuery(d,a,b),this._parts.query=j.buildQuery(d),"string"!=typeof a&&(c=b),this.build(!c),this},k.removeQuery=function(a,b,c){var d=j.parseQuery(this._parts.query);return j.removeQuery(d,a,b),this._parts.query=j.buildQuery(d),"string"!=typeof a&&(c=b),this.build(!c),this},k.addSearch=k.addQuery,k.removeSearch=k.removeQuery,k.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},k.normalizeProtocol=function(a){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!a)),this},k.normalizeHostname=function(a){return this._parts.hostname&&(this.is("IDN")&&g?this._parts.hostname=g.toASCII(this._parts.hostname):this.is("IPv6")&&h&&(this._parts.hostname=h.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!a)),this},k.normalizePort=function(a){return"string"==typeof this._parts.protocol&&this._parts.port===j.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!a)),this},k.normalizePath=function(a){if(this._parts.urn)return this;if(!this._parts.path||"/"===this._parts.path)return this;var b,c,d,e,f=this._parts.path;for("/"!==f[0]&&("."===f[0]&&(c=f.substring(0,f.indexOf("/"))),b=!0,f="/"+f),f=f.replace(/(\/(\.\/)+)|\/{2,}/g,"/");d=f.indexOf("/../"),-1!==d;){if(0===d){f=f.substring(3);break}e=f.substring(0,d).lastIndexOf("/"),-1===e&&(e=d),f=f.substring(0,e)+f.substring(d+3)}return b&&this.is("relative")&&(f=c?c+f:f.substring(1)),f=j.recodePath(f),this._parts.path=f,this.build(!a),this},k.normalizePathname=k.normalizePath,k.normalizeQuery=function(a){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(j.parseQuery(this._parts.query)):this._parts.query=null,this.build(!a)),this},k.normalizeFragment=function(a){return this._parts.fragment||(this._parts.fragment=null,this.build(!a)),this},k.normalizeSearch=k.normalizeQuery,k.normalizeHash=k.normalizeFragment,k.iso8859=function(){var a=j.encode,b=j.decode;return j.encode=escape,j.decode=decodeURIComponent,this.normalize(),j.encode=a,j.decode=b,this},k.unicode=function(){var a=j.encode,b=j.decode;return j.encode=encodeURIComponent,j.decode=unescape,this.normalize(),j.encode=a,j.decode=b,this},k.readable=function(){var b=new j(this);b.username("").password("").normalize();var c="";if(b._parts.protocol&&(c+=b._parts.protocol+"://"),b._parts.hostname&&(b.is("punycode")&&g?(c+=g.toUnicode(b._parts.hostname),b._parts.port&&(c+=":"+b._parts.port)):c+=b.host()),b._parts.hostname&&b._parts.path&&"/"!==b._parts.path[0]&&(c+="/"),c+=b.path(!0),b._parts.query){for(var d="",e=0,f=b._parts.query.split("&"),h=f.length;h>e;e++){var i=(f[e]||"").split("=");d+="&"+j.decodeQuery(i[0]).replace(/&/g,"%26"),i[1]!==a&&(d+="="+j.decodeQuery(i[1]).replace(/&/g,"%26"))}c+="?"+d.substring(1)}return c+=b.hash()},k.absoluteTo=function(a){if(this._parts.urn)throw new Error("URNs do not have any generally defined hierachical components");a instanceof j||(a=new j(a));for(var b,c,d=new j(this),e=["protocol","username","password","hostname","port"],f=0;c=e[f];f++)d._parts[c]=a._parts[c];return"/"!==d.path()[0]&&(b=a.directory(),d._parts.path=(b?b+"/":"")+d._parts.path,d.normalizePath()),d.build(),d},k.relativeTo=function(a){if(this._parts.urn)throw new Error("URNs do not have any generally defined hierachical components");if(a instanceof j||(a=new j(a)),"/"!==this.path()[0]||"/"!==a.path()[0])throw new Error("Cannot calculate common path from non-relative URLs");for(var c,d=new j(this),e=["protocol","username","password","hostname","port"],f=j.commonPath(d.path(),a.path()),g=a.directory(),h=0;c=e[h];h++)d._parts[c]=null;if(!f||"/"===f)return d;if(g+"/"===f)d._parts.path="./"+d.filename();else{for(var i="../",k=new RegExp("^"+b(f)),l=g.replace(k,"/").match(/\//g).length-1;l--;)i+="../";d._parts.path=d._parts.path.replace(k,i)}return d.build(),d},k.equals=function(a){var b,d,e,f=new j(this),g=new j(a),h={},i={},k={};if(f.normalize(),g.normalize(),f.toString()===g.toString())return!0;if(b=f.query(),d=g.query(),f.query(""),g.query(""),f.toString()!==g.toString())return!1;if(b.length!==d.length)return!1;h=j.parseQuery(b),i=j.parseQuery(d);for(e in h)if(Object.prototype.hasOwnProperty.call(h,e)){if(c(h[e])){if(!c(i[e]))return!1;if(h[e].length!==i[e].length)return!1;h[e].sort(),i[e].sort();for(var l=0,m=h[e].length;m>l;l++)if(h[e][l]!==i[e][l])return!1}else if(h[e]!==i[e])return!1;k[e]=!0}for(e in i)if(Object.prototype.hasOwnProperty.call(i,e)&&!k[e])return!1;return!0},"undefined"!=typeof module&&module.exports?module.exports=j:window.URI=j}(),window.rasterizeHTMLInline=function(a){"use strict";var b=function(b,c,d,e,f){var g=b.attributes.src.nodeValue,h=c||b.ownerDocument.baseURI;return a.util.isDataUri(g)?(e(),void 0):(g=a.util.getUrlRelativeToDocumentBase(g,h),a.util.getDataURIForImageURL(g,{cache:d},function(a){b.attributes.src.nodeValue=a,e()},function(){f(g)}),void 0)},c=function(a){var b=[];return Array.prototype.forEach.call(a,function(a){"image"===a.type&&b.push(a)}),b};a.loadAndInlineImages=function(d,e,f){var g=a.util.parseOptionalParameters(e,f),h=d.getElementsByTagName("img"),i=d.getElementsByTagName("input"),j=g.options.baseUrl,k=g.options.cache!==!1,l=[],m=[];l=Array.prototype.slice.call(h),l=l.concat(c(i)),a.util.map(l,function(a,c){b(a,j,k,c,function(a){m.push({resourceType:"image",url:a,msg:"Unable to load image "+a}),c()})},function(){g.callback&&g.callback(m)})};var d=function(b,c,d,e,f){var g=a.css.rulesForCssText(b.textContent);a.css.loadCSSImportsForRules(g,c,d,e,function(e,h){a.css.loadAndInlineCSSResourcesForRules(g,c,d,function(c,d){var i=h.concat(d);(e||c)&&(b.childNodes[0].nodeValue=a.css.cssRulesToText(g)),f(i)})})};a.loadAndInlineStyles=function(b,c,e){var f=a.util.parseOptionalParameters(c,e),g=b.getElementsByTagName("style"),h=f.options.baseUrl||b.baseURI,i=f.options.cache!==!1,j=[],k=[];a.util.map(g,function(a,b){a.attributes.type&&"text/css"!==a.attributes.type.nodeValue?b():d(a,h,i,k,function(a){j=j.concat(a),b()})},function(){f.callback(j)})};var e=function(a,b){var c,d=a.parentNode;b=b.trim(),b&&(c=a.ownerDocument.createElement("style"),c.type="text/css",c.appendChild(a.ownerDocument.createTextNode(b)),d.insertBefore(c,a)),d.removeChild(a)},f=function(b,c,d,e,f){var g=b.attributes.href.nodeValue,h=c||b.ownerDocument.baseURI,i=a.util.getUrlRelativeToDocumentBase(g,h);a.util.ajax(i,{cache:d},function(b){var c,f=a.css.rulesForCssText(b);c=a.css.adjustPathsOfCssResources(g,f),a.css.loadCSSImportsForRules(f,h,d,[],function(g,i){a.css.loadAndInlineCSSResourcesForRules(f,h,d,function(d,h){var j=i.concat(h);(c||g||d)&&(b=a.css.cssRulesToText(f)),e(b,j)})})},function(){f(i)})};a.loadAndInlineCssLinks=function(b,c,d){var g=a.util.parseOptionalParameters(c,d),h=b.getElementsByTagName("link"),i=g.options.baseUrl,j=g.options.cache!==!1,k=[];a.util.map(h,function(a,b){!a.attributes.rel||"stylesheet"!==a.attributes.rel.nodeValue||a.attributes.type&&"text/css"!==a.attributes.type.nodeValue?b():f(a,i,j,function(c,d){e(a,c+"\n"),k=k.concat(d),b()},function(a){k.push({resourceType:"stylesheet",url:a,msg:"Unable to load stylesheet "+a}),b()})},function(){g.callback&&g.callback(k)})};var g=function(b,c,d,e,f){var g=c||b.ownerDocument.baseURI,h=a.util.getUrlRelativeToDocumentBase(b.attributes.src.nodeValue,g);a.util.ajax(h,{cache:d},e,function(){f(h)})},h=function(a,b){var c=a.ownerDocument.createElement("script"),d=a.parentNode;a.attributes.type&&(c.type=a.attributes.type.nodeValue),c.appendChild(a.ownerDocument.createTextNode(b)),d.insertBefore(c,a),d.removeChild(a)};return a.loadAndInlineScript=function(b,c,d){var e=a.util.parseOptionalParameters(c,d),f=b.getElementsByTagName("script"),i=e.options.cache!==!1,j=[];a.util.map(f,function(a,b){a.attributes.src?g(a,e.options.baseUrl,i,function(c){h(a,c),b()},function(a){j.push({resourceType:"script",url:a,msg:"Unable to load script "+a}),b()}):b()},function(){e.callback&&e.callback(j)})},a.inlineReferences=function(b,c,d){var e=[];a.loadAndInlineImages(b,c,function(f){e=e.concat(f),a.loadAndInlineStyles(b,c,function(f){e=e.concat(f),a.loadAndInlineCssLinks(b,c,function(f){e=e.concat(f),a.loadAndInlineScript(b,c,function(a){e=e.concat(a),d(e)})})})})},a}(window.rasterizeHTMLInline||{}),window.rasterizeHTMLInline=function(a,b,c){"use strict";a.css={};var d=function(a){return Array.prototype.slice.call(a)},e=function(a){var b,c=document.implementation.createHTMLDocument(""),e=document.createElement("style");return e.textContent=a,c.body.appendChild(e),b=e.sheet.cssRules,d(b)};a.css.rulesForCssText=function(a){return c.parse&&b.navigator.userAgent.indexOf("Chrome")>=0?c.parse(a).cssRules:e(a)};var f=function(a){var c=[];return a.forEach(function(a){a.type===b.CSSRule.STYLE_RULE&&(a.style.getPropertyValue("background-image")||a.style.getPropertyValue("background"))&&c.push(a)}),c},g=function(a){var c=[];return a.forEach(function(a){a.type===b.CSSRule.FONT_FACE_RULE&&a.style.getPropertyValue("src")&&c.push(a)}),c};a.css.cssRulesToText=function(a){var b="";return a.forEach(function(a){b+=a.cssText}),b};var h=function(a){var b=/^"(.*)"$/,c=/^'(.*)'$/;return b.test(a)?a.replace(b,"$1"):c.test(a)?a.replace(c,"$1"):a},i=function(a){var b=/^[\t\r\f\n ]*(.+?)[\t\r\f\n ]*$/;return a.replace(b,"$1")};a.css.extractCssUrl=function(a){var b,c=/^url\(([^\)]+)\)/;if(!c.test(a))throw new Error("Invalid url");return b=c.exec(a)[1],h(i(b))};var j=function(a){var b,c=/^format\(([^\)]+)\)/;return c.test(a)?(b=c.exec(a)[1],h(b)):null},k=function(b){var c,d=null;try{return c=a.css.extractCssUrl(b[0]),b[1]&&(d=j(b[1])),{url:c,format:d}}catch(e){}},l=function(a,b,c){var d=a.indexOf(b),e="@font-face { font-family: "+b.style.getPropertyValue("font-family")+"; src: "+c+"}",f=b.parentStyleSheet;f.insertRule(e,d+1),f.deleteRule(d),a[d]=f.cssRules[d]};a.css.adjustPathsOfCssResources=function(b,c){var d,e=!1;return f(c).forEach(function(c){var f=c.style.getPropertyValue("background-image")||c.style.getPropertyValue("background"),g=q(f),h=!1;g.forEach(function(c){var d,e=r(c);e&&!a.util.isDataUri(e.url)&&(d=a.util.joinUrl(b,e.url),c[e.idx]='url("'+d+'")',h=!0)}),d=s(g),c.style.getPropertyValue("background-image")?c.style.setProperty("background-image",d):c.style.setProperty("background",d),e=e||h}),g(c).forEach(function(d){var f=v(d.style.getPropertyValue("src")),g=!1;f.forEach(function(c){var d,e=k(c);e&&!a.util.isDataUri(e.url)&&(d=a.util.joinUrl(b,e.url),c[0]='url("'+d+'")',g=!0)}),g&&l(c,d,w(f)),e=e||g}),e};var m=function(a){var c=[];return a.forEach(function(a){a.type===b.CSSRule.IMPORT_RULE&&a.href&&c.push(a)}),c},n=function(a,b,c){var d=a.indexOf(b);a.splice(d,1),c.forEach(function(b,c){a.splice(d+c,0,b)})},o=function(a){var b=/^"(.*)"$/,c=/^'(.*)'$/;return b.test(a)||c.test(a)},p=function(b,c,d,e,f,g,i){var j,k=c.href;return o(k)&&(k=h(k)),j=a.util.getUrlRelativeToDocumentBase(k,d),f.indexOf(j)>=0?(n(b,c,[]),g([]),void 0):(f.push(j),a.util.ajax(j,{cache:e},function(h){var i=a.css.rulesForCssText(h);a.css.loadCSSImportsForRules(i,d,e,f,function(d,e){a.css.adjustPathsOfCssResources(k,i),n(b,c,i),g(e)})},function(){i(j)}),void 0)};a.css.loadCSSImportsForRules=function(b,c,d,e,f){var g,h=[];g=m(b),a.util.map(g,function(a,f){p(b,a,c,d,e,function(a){h=h.concat(a),f(!0)},function(a){h.push({resourceType:"stylesheet",url:a,msg:"Unable to load stylesheet "+a}),f(!1)})},function(a){var b=a.indexOf(!0)>=0;f(b,h)})};var q=function(a){var b,c="\\s*(?:\"[^\"]*\"|'[^']*'|[^\\(]+)\\s*",d="(url\\("+c+"\\)"+"|"+"[^,\\s]+"+")",e="(?:\\s*"+d+")+",f="^\\s*("+e+")"+"(?:\\s*,\\s*("+e+"))*"+"\\s*$",g=new RegExp(e,"g"),h=[],i=function(a){var b,c=new RegExp(d,"g"),e=[];for(b=c.exec(a);b;)e.push(b[1]),b=c.exec(a);return e};if(a.match(new RegExp(f))){for(b=g.exec(a);b;)h.push(i(b[0])),b=g.exec(a);return h}return[]},r=function(b){var c,d;for(c=0;c<b.length;c++)try{return d=a.css.extractCssUrl(b[c]),{url:d,idx:c}}catch(e){}},s=function(a){var b=[];return a.forEach(function(a){b.push(a.join(" "))}),b.join(", ")},t=function(b,c,d,e){var f,g,h=[],i=b.style.getPropertyValue("background-image")||b.style.getPropertyValue("background");f=q(i),a.util.map(f,function(b,e){var f,g=r(b);return!g||a.util.isDataUri(g.url)?(e(!1),void 0):(f=a.util.getUrlRelativeToDocumentBase(g.url,c),a.util.getDataURIForImageURL(f,{cache:d},function(a){b[g.idx]='url("'+a+'")',e(!0)},function(){h.push(f),e(!1)}),void 0)},function(a){var c=a.indexOf(!0)>=0;c&&(g=s(f),b.style.getPropertyValue("background-image")?b.style.setProperty("background-image",g):b.style.setProperty("background",g)),e(c,h)})},u=function(b,c,d,e){var g,h=f(b),i=[];a.util.map(h,function(a,b){t(a,c,d,function(a,c){c.forEach(function(a){i.push({resourceType:"backgroundImage",url:a,msg:"Unable to load background-image "+a})}),b(a)})},function(a){g=a.indexOf(!0)>=0,e(g,i)})},v=function(a){var b,c="\\s*(?:\"[^\"]*\"|'[^']*'|[^\\(]+)\\s*",d="(local\\("+c+"\\))"+"|"+"(url\\("+c+"\\))"+"(?:\\s+(format\\("+c+"\\)))?",e="^\\s*("+d+")"+"(?:\\s*,\\s*("+d+"))*"+"\\s*$",f=new RegExp(d,"g"),g=[],h=function(a){var b=[];return a.slice(1).forEach(function(a){a&&b.push(a)}),b};if(a.match(new RegExp(e))){for(b=f.exec(a);b;)g.push(h(b)),b=f.exec(a);return g}return[]},w=function(a){var b=[];return a.forEach(function(a){b.push(a.join(" "))}),b.join(", ")},x=function(b,c,d,e,f){var g,h,i,j,m,n=[];g=v(c.style.getPropertyValue("src")),a.util.map(g,function(b,c){return h=k(b),!h||a.util.isDataUri(h.url)?(c(!1),void 0):(i=a.util.getUrlRelativeToDocumentBase(h.url,d),j=h.format||"woff",a.util.binaryAjax(i,{cache:e},function(a){m=btoa(a),b[0]='url("data:font/'+j+";base64,"+m+'")',c(!0)},function(){n.push(i),c(!1)}),void 0)},function(a){var d=a.indexOf(!0)>=0;d&&l(b,c,w(g)),f(d,n)})},y=function(b,c,d,e){var f,h=g(b),i=[];a.util.map(h,function(a,e){x(b,a,c,d,function(a,b){b.forEach(function(a){i.push({resourceType:"fontFace",url:a,msg:"Unable to load font-face "+a})}),e(a)})},function(a){f=a.indexOf(!0)>=0,e(f,i)})};return a.css.loadAndInlineCSSResourcesForRules=function(a,b,c,d){u(a,b,c,function(e,f){y(a,b,c,function(a,b){var c=e||a;d(c,f.concat(b))})})},a}(window.rasterizeHTMLInline||{},window,window.CSSOM||{}),window.rasterizeHTMLInline=function(a,b,c){"use strict";a.util={},a.util.getUrlRelativeToDocumentBase=function(b,c){return c&&"about:blank"!==c&&(b=a.util.joinUrl(c,b)),b},a.util.cloneArray=function(a){return Array.prototype.slice.apply(a,[0])},a.util.joinUrl=function(a,b){var d=new c(b);return d.is("relative")&&(d=d.absoluteTo(a)),d.toString()},a.util.isDataUri=function(a){return/^data:/.test(a)},a.util.map=function(b,c,d){var e,f=0,g=a.util.cloneArray(b),h=[];0===g.length&&d(h);var i=function(a){function b(b){f+=1,h[a]=b,f===g.length&&d(h)}c(g[a],b)};for(e=0;e<g.length;e++)i(e)};var d=null,e=function(a,b,c){return b?(null!==d&&c||(d=Date.now()),a+"?_="+d):a};a.util.ajax=function(a,c,d,f){var g,h=new b.XMLHttpRequest;c=c||{},g=e(a,c.cache===!1,c.cacheRepeated),h.addEventListener("load",function(){200===h.status||0===h.status?d(h.response):f()},!1),h.addEventListener("error",function(){f()},!1);try{h.open("GET",g,!0),h.overrideMimeType(c.mimeType),h.send(null)}catch(i){f()}},a.util.binaryAjax=function(b,c,d,e){var f="";c=c||{},a.util.ajax(b,{mimeType:"text/plain; charset=x-user-defined",cache:c.cache},function(a){for(var b=0;b<a.length;b++)f+=String.fromCharCode(255&a.charCodeAt(b));d(f)},e)};var f=function(a){var b=function(a,b){return a.substring(0,b.length)===b};return b(a,"<?xml")||b(a,"<svg")?"image/svg+xml":"image/png"};a.util.getDataURIForImageURL=function(b,c,d,e){var g,h;a.util.binaryAjax(b,c,function(a){g=btoa(a),h=f(a),d("data:"+h+";base64,"+g)},function(){e()})};var g=function(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},h=function(a){return"function"==typeof a};return a.util.parseOptionalParameters=function(){var a={options:{},callback:null};return h(arguments[0])?a.callback=arguments[0]:(a.options=g(arguments[0]),a.callback=arguments[1]||null),a},a}(window.rasterizeHTMLInline||{},window,URI),window.rasterizeHTML=function(a,b,c){"use strict";var d={},e=[];d.util={},d.util.getConstantUniqueIdFor=function(a){return e.indexOf(a)<0&&e.push(a),e.indexOf(a)},d.util.log=function(a){c.console&&c.console.log&&c.console.log(a)};var f=function(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},g=function(a){return"object"==typeof a&&null!==a},h=function(a){return g(a)&&Object.prototype.toString.apply(a).match(/\[object (Canvas|HTMLCanvasElement)\]/i)},i=function(a){return"function"==typeof a};d.util.parseOptionalParameters=function(){var a={canvas:null,options:{},callback:null};return i(arguments[0])?a.callback=arguments[0]:null==arguments[0]||h(arguments[0])?(a.canvas=arguments[0]||null,i(arguments[1])?a.callback=arguments[1]:(a.options=f(arguments[1]),a.callback=arguments[2]||null)):(a.options=f(arguments[0]),a.callback=arguments[1]||null),a};var j=function(a){return(""+function(a){window.parent.rasterizeHTML.util.reportIframeJsError("put_unique_id_here",a)}).replace("put_unique_id_here",a)},k={};d.util.reportIframeJsError=function(a,b){var c=k[a]||[];c.push(b),k[a]=c};var l=function(a){var b=[];return k[a]&&k[a].forEach(function(a){b.push({resourceType:"scriptExecution",msg:a})}),b};d.util.executeJavascript=function(a,b,e){var f=s(c.document,"iframe"),g=a.getElementsByTagName("html")[0].innerHTML,h=d.util.getConstantUniqueIdFor(a),i="<script>window.onerror = "+j(h)+";</script>",k=function(){var a=f.contentDocument;c.document.getElementsByTagName("body")[0].removeChild(f),e(a,l(h))};f.onload=b>0?function(){setTimeout(k,b)}:k,f.contentDocument.open(),f.contentDocument.write("<html>"+i+g+"</html>"),f.contentDocument.close()};var m=function(){return c.navigator.userAgent.indexOf("WebKit")>=0},n=function(a){var e;return a.documentElement.setAttribute("xmlns",a.documentElement.namespaceURI),e=(new c.XMLSerializer).serializeToString(a.documentElement),m()?b?b(e):(d.util.log("Looks like your browser needs htmlparser.js as workaround for writing XML. Please include it."),e):e},o=function(){if(c.navigator.userAgent.indexOf("WebKit")>=0&&c.navigator.userAgent.indexOf("Chrome")<0)return!1;if(c.BlobBuilder||c.MozBlobBuilder||c.WebKitBlobBuilder)return!0;if(c.Blob)try{return new c.Blob(["<b></b>"],{type:"text/xml"}),!0}catch(a){return!1}return!1},p=function(a){var b,d="image/svg+xml;charset=utf-8",e=c.BlobBuilder||c.MozBlobBuilder||c.WebKitBlobBuilder;return e?(b=new e,b.append(a),b.getBlob(d)):new c.Blob([a],{type:d})},q=function(a){var b=c.URL||c.webkitURL||window;return o()?b.createObjectURL(p(a)):"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a)},r=function(a){var b=c.URL||c.webkitURL||window;o()&&b.revokeObjectURL(a)},s=function(a,b){var c=a.createElement(b);return c.style.visibility="hidden",c.style.width="0px",c.style.height="0px",c.style.position="absolute",c.style.top="-10000px",c.style.left="-10000px",a.getElementsByTagName("body")[0].appendChild(c),c},t=function(a,b){var c=a.getElementById(b);return c||(c=s(a,"div"),c.id=b),c},u="rasterizeHTML_js_FirefoxWorkaround",v=function(){var a=c.navigator.userAgent.match(/Firefox\/(\d+).0/);return!a||!a[1]||parseInt(a[1],10)<17},w=function(a,b){var e,f=d.util.getConstantUniqueIdFor(a),g=b?b.ownerDocument:c.document;v()&&(e=t(g,u+f),e.innerHTML=a,e.className=u)},x=function(a){window.navigator.userAgent.indexOf("WebKit")>=0&&Array.prototype.forEach.call(a.getElementsByTagName("style"),function(a){a.textContent="span {}\n"+a.textContent})},y=function(a,b){var e=d.util.getConstantUniqueIdFor(a),f=b?b.ownerDocument:c.document,g=f.getElementById(u+e);g&&g.parentNode.removeChild(g)};d.getSvgForDocument=function(a,b,c){var d;return x(a),d=n(a),'<svg xmlns="http://www.w3.org/2000/svg" width="'+b+'" height="'+c+'">'+'<foreignObject width="100%" height="100%">'+d+"</foreignObject>"+"</svg>"},d.renderSvg=function(a,b,d,e){var f,g,h=function(){g.onload=null,g.onerror=null},i=function(){f&&r(f),y(a,b)};w(a,b),f=q(a),g=new c.Image,g.onload=function(){h(),i(),d(g)},g.onerror=function(){i(),e()},g.src=f},d.drawImageOnCanvas=function(a,b){try{b.getContext("2d").drawImage(a,0,0)}catch(c){return!1}return!0};var z=function(a,b,c,e,f,g){var h,i=d.getSvgForDocument(a,b,c),j=function(a){a.push({resourceType:"document",msg:"Error rendering page"})};d.renderSvg(i,e,function(a){e&&(h=d.drawImageOnCanvas(a,e),h||(j(g),a=null)),f&&f(a,g)},function(){j(g),f&&f(null,g)})};return d.drawDocument=function(b,c,e,f){var g=d.util.parseOptionalParameters(c,e,f),h=g.canvas?g.canvas.width:300,i=g.canvas?g.canvas.height:200,j=void 0!==g.options.width?g.options.width:h,k=void 0!==g.options.height?g.options.height:i,l=g.options.executeJsTimeout||0;a.inlineReferences(b,g.options,function(a){g.options.executeJs?d.util.executeJavascript(b,l,function(b,c){z(b,j,k,g.canvas,g.callback,a.concat(c))}):z(b,j,k,g.canvas,g.callback,a)})},d.drawHTML=function(a,b,e,f){var g=d.util.parseOptionalParameters(b,e,f),h=c.document.implementation.createHTMLDocument("");h.documentElement.innerHTML=a,d.drawDocument(h,g.canvas,g.options,g.callback)},d.drawURL=function(b,c,e,f){var g=d.util.parseOptionalParameters(c,e,f),h=g.options.cache;g.options.baseUrl=b,a.util.ajax(b,{cache:h},function(a){d.drawHTML(a,g.canvas,g.options,g.callback)},function(){g.callback&&g.callback(null,[{resourceType:"page",url:b,msg:"Unable to load page "+b}])})},d}(window.rasterizeHTMLInline,window.HTMLtoXML,window),function(a,b){var c=this;if("undefined"!=typeof module){var d=require("canvas");module.exports=b(c,a,d)}else"function"==typeof define&&"object"==typeof define.amd?define(b):c[a]=b(c,a)}("imagediff",function(a,b,c){function d(a,b){var d=c?new c:document.createElement("canvas");return a&&(d.width=a),b&&(d.height=b),d}function e(a,b){return I.width=a,I.height=b,J.clearRect(0,0,a,b),J.createImageData(a,b)}function f(a){return k(a,F)}function g(a){return k(a,D)}function h(a){return k(a,E)}function i(a){return!(!a||!k(a,G)||typeof a.width===H||typeof a.height===H||typeof a.data===H)}function j(a){return f(a)||g(a)||h(a)||i(a)}function k(a,b){return"object"==typeof a&&!!Object.prototype.toString.apply(a).match(b)}function l(a){var b,c,d,e=a.height,f=a.width,g=a.data;for(I.width=f,I.height=e,b=J.getImageData(0,0,f,e),c=b.data,d=a.data.length;d--;)c[d]=g[d];return b}function m(a){return f(a)?n(a):g(a)?o(a):h(a)?p(a):i(a)?a:void 0}function n(a){var b=a.height,c=a.width;return I.width=c,I.height=b,J.clearRect(0,0,c,b),J.drawImage(a,0,0),J.getImageData(0,0,c,b)}function o(a){var b=a.height,c=a.width,d=a.getContext("2d");return d.getImageData(0,0,c,b)}function p(a){var b=a.canvas,c=b.height,d=b.width;return a.getImageData(0,0,d,c)}function q(a){var b=m(a),c=d(b.width,b.height),e=c.getContext("2d");return e.putImageData(b,0,0),c}function r(a,b){return a.width===b.width}function s(a,b){return a.height===b.height}function t(a,b){return s(a,b)&&r(a,b)}function u(a,b,c){var d,e=a.data,f=b.data,g=e.length;if(c=c||0,!t(a,b))return!1;for(d=g;d--;)if(e[d]!==f[d]&&Math.abs(e[d]-f[d])>c)return!1;return!0}function v(a,b){return(t(a,b)?w:x)(a,b)}function w(a,b){var c,d=a.height,f=a.width,g=e(f,d),h=a.data,i=b.data,j=g.data,k=j.length;for(c=0;k>c;c+=4)j[c]=Math.abs(h[c]-i[c]),j[c+1]=Math.abs(h[c+1]-i[c+1]),j[c+2]=Math.abs(h[c+2]-i[c+2]),j[c+3]=Math.abs(255-h[c+3]-i[c+3]);return g}function x(a,b){function c(a){d=Math.floor((k-a.height)/2),f=Math.floor((l-a.width)/2)}var d,f,g,h,i,j,k=Math.max(a.height,b.height),l=Math.max(a.width,b.width),m=e(l,k),n=a.data,o=b.data,p=m.data;for(i=p.length-1;i>0;i-=4)p[i]=255;for(c(a),g=a.height;g--;)for(h=a.width;h--;)i=4*((g+d)*l+(h+f)),j=4*(g*a.width+h),p[i+0]=n[j+0],p[i+1]=n[j+1],p[i+2]=n[j+2];for(c(b),g=b.height;g--;)for(h=b.width;h--;)i=4*((g+d)*l+(h+f)),j=4*(g*b.width+h),p[i+0]=Math.abs(p[i+0]-o[j+0]),p[i+1]=Math.abs(p[i+1]-o[j+1]),p[i+2]=Math.abs(p[i+2]-o[j+2]);return m}function y(){var a;for(a=0;a<arguments.length;a++)if(!j(arguments[a]))throw{name:"ImageTypeError",message:"Submitted object was not an image."}}function z(a,b){return a=document.createElement(a),a&&b&&(a.innerHTML=b),a}function A(a,b,c){var d,e,f=q(a);c=c||Function,d=f.toDataURL().replace(/^data:image\/\w+;base64,/,""),e=new Buffer(d,"base64"),require("fs").writeFile(b,e,c)}var B,C,D=/\[object (Canvas|HTMLCanvasElement)\]/i,E=/\[object CanvasRenderingContext2D\]/i,F=/\[object (Image|HTMLImageElement)\]/i,G=/\[object ImageData\]/i,H="undefined",I=d(),J=I.getContext("2d"),K=a[b];return C={toBeImageData:function(){return B.isImageData(this.actual)},toImageDiffEqual:function(a,b){return typeof document!==H&&(this.message=function(){var b,c=z("div"),e=z("div","<div>Actual:</div>"),f=z("div","<div>Expected:</div>"),g=z("div","<div>Diff:</div>"),h=B.diff(this.actual,a),i=d();return i.height=h.height,i.width=h.width,b=i.getContext("2d"),b.putImageData(h,0,0),e.appendChild(q(this.actual)),f.appendChild(q(a)),g.appendChild(i),c.appendChild(e),c.appendChild(f),c.appendChild(g),[c,"Expected not to be equal."]}),B.equal(this.actual,a,b)}},B={createCanvas:d,createImageData:e,isImage:f,isCanvas:g,isContext:h,isImageData:i,isImageType:j,toImageData:function(a){return y(a),i(a)?l(a):m(a)},equal:function(a,b,c){return y(a,b),a=m(a),b=m(b),u(a,b,c)},diff:function(a,b){return y(a,b),a=m(a),b=m(b),v(a,b)},jasmine:C,noConflict:function(){return a[b]=K,B}},"undefined"!=typeof module&&(B.imageDataToPNG=A),B}),window.csscritic=function(a){a.util={},a.util.getDataURIForImage=function(a){var b=window.document.createElement("canvas"),c=b.getContext("2d");return b.width=a.width,b.height=a.height,c.drawImage(a,0,0),b.toDataURL("image/png")},a.util.getImageForUrl=function(a,b,c){var d=new window.Image;d.onload=function(){b(d)},c&&(d.onerror=c),d.src=a},a.util.getImageForBinaryContent=function(a,b){var c=new window.Image;c.onload=function(){b(c)},c.onerror=function(){b(null)},c.src="data:image/png;base64,"+btoa(a)};var b=function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(255&a.charCodeAt(c));return b},c=function(a){return a+"?_="+Date.now()};a.util.ajax=function(a,d,e){var f=new XMLHttpRequest;f.onload=function(){200===f.status||0===f.status?d(b(f.response)):e()},f.onerror=function(){e()};try{f.open("get",c(a),!0),f.overrideMimeType("text/plain; charset=x-user-defined"),f.send()}catch(g){e()}},a.util.workAroundTransparencyIssueInFirefox=function(b,c){var d;try{d=a.util.getDataURIForImage(b)}catch(e){return c(b),void 0}a.util.getImageForUrl(d,function(a){c(a)})},a.util.map=function(a,b,c){var d,e=0,f=[];0===a.length&&c(f);var g=function(d){function g(b){e+=1,f[d]=b,e===a.length&&c(f)}b(a[d],g)};for(d=0;d<a.length;d++)g(d)},a.util.queue={};var d=[],e=!1,f=function(){var a;d.length>0?(e=!0,a=d.shift(),a(f)):e=!1};return a.util.queue.execute=function(a){d.push(a),e||f()},a.util.queue.clear=function(){d=[],e=!1},a}(window.csscritic||{}),window.csscritic=function(a,b){a.renderer=a.renderer||{};var c=function(a){var b=[];return a.forEach(function(a){a.msg&&b.push(a.msg)}),b},d=function(d,e,f,g,h,i){a.util.queue.execute(function(a){b.drawHTML(e,{cache:!1,cacheRepeated:!0,width:f,height:g,executeJs:!0,executeJsTimeout:50,baseUrl:d},function(b,d){var e=void 0===d?[]:c(d);b?h(b,e):i(),a()})})};return a.renderer.browserRenderer=function(b,c,e,f,g,h){var i=b;f&&(i=f+"/inline?url="+b),a.util.ajax(i,function(b){a.util.getImageForBinaryContent(b,function(a){a?g(a,[]):d(i,b,c,e,function(a,b){g(a,b)},function(){h&&h()})})},function(){h&&h()})},a.renderer.getImageForPageUrl=a.renderer.browserRenderer,a}(window.csscritic||{},rasterizeHTML),window.csscritic=function(a,b){return a.storage=a.storage||{},a.domstorage={},a.domstorage.storeReferenceImage=function(c,d){var e,f;try{e=a.util.getDataURIForImage(d)}catch(g){throw window.alert("An error occurred reading the canvas. Are you sure you are using Firefox?\n"+g),g}f={referenceImageUri:e},b.setItem(c,JSON.stringify(f))},a.domstorage.readReferenceImage=function(c,d,e){var f,g=b.getItem(c);g?(f=JSON.parse(g),a.util.getImageForUrl(f.referenceImageUri,function(a){d(a)},e)):e()},a.storage.storeReferenceImage=a.domstorage.storeReferenceImage,a.storage.readReferenceImage=a.domstorage.readReferenceImage,a}(window.csscritic||{},localStorage),window.csscritic=function(a,b,c,d,e){var f,g,h,i=function(){f=[],g=[],h=null};i(),a.setProxy=function(a){h=a};var j=function(a){var d={status:a.status,pageUrl:a.pageUrl,pageImage:a.htmlImage};return a.htmlImage&&(d.resizePageImage=function(c,e,f){b.getImageForPageUrl(a.pageUrl,c,e,h,function(a){d.pageImage=a,f(a)})},d.acceptPage=function(){c.storeReferenceImage(a.pageUrl,d.pageImage)}),a.referenceImage&&(d.referenceImage=a.referenceImage),a.renderErrors&&a.renderErrors.length&&(d.renderErrors=a.renderErrors),d},k=function(b,c){a.util.map(b,function(b,c){a.util.map(f,function(a,c){a.reportComparisonStarting?a.reportComparisonStarting({pageUrl:b},c):c()},c)},c)},l=function(a,b){var c,d,e=0,g=f.length,h=function(){e+=1,e===g&&b()};if(!g)return b(),void 0;for(d=j(a),c=0;g>c;c++)f[c].reportComparison(d,h)},m=function(b,c){a.util.map(f,function(a,c){a.report?a.report({success:b},c):c()},c)};a.addReporter=function(a){f.push(a)},a.clearReporters=function(){f=[]};var n=function(a,b){b&&e.diff(a,b)},o=function(c,d,f,g,i){b.getImageForPageUrl(c,d,f,h,function(b,d){var f,h;n(b,g),a.util.workAroundTransparencyIssueInFirefox(b,function(a){g?(f=e.equal(a,g),h=f?"passed":"failed"):h="referenceMissing",l({status:h,pageUrl:c,htmlImage:b,referenceImage:g,renderErrors:d},function(){i&&i(h)})})},function(){var a="error";l({status:a,pageUrl:c},function(){i&&i(a)})})};return a.compare=function(a,b){c.readReferenceImage(a,function(c){o(a,c.width,c.height,c,b)},function(){o(a,800,600,null,b)})},a.add=function(a){g.push(a)},a.execute=function(b){k(g,function(){a.util.map(g,function(b,c){a.compare(b,function(a){c("passed"===a)})},function(a){var c=-1===a.indexOf(!1);m(c,function(){b&&b(c)})})})},a.clear=i,a}(window.csscritic||{},window.csscritic.renderer,window.csscritic.storage,window,imagediff),window.csscritic=function(a,b){a.basicHTMLReporterUtil={};var c=function(a){var c,d=b.createElement("canvas");return d.height=a.height,d.width=a.width,c=d.getContext("2d"),c.putImageData(a,0,0),d};a.basicHTMLReporterUtil.getDifferenceCanvas=function(a,b){var d=imagediff.diff(a,b);return c(d)};var d=function(a){var b=Math.log(256);return Math.floor(255*Math.log(a+1)/b)};a.basicHTMLReporterUtil.getHighlightedDifferenceCanvas=function(a,b){for(var e=imagediff.diff(a,b),f=0;f<e.data.length;f++)3>f%4&&(e.data[f]=d(e.data[f]));return c(e)};var e=function(a,b){var c=a.style.width,d=a.style.height;
a.onmouseup=function(){(c!==a.style.width||d!==a.style.height)&&(c=a.style.width,d=a.style.height,b(c,d))}},f=function(){var a,c="csscritic_basichtmlreporter",d=b.getElementById(c);return null===d&&(d=b.createElement("div"),d.id=c,a=b.createElement("div"),a.className="timeTaken",d.appendChild(a),b.getElementsByTagName("body")[0].appendChild(d)),d},g=function(a,c){var d,f=b.createElement("div"),g=b.createElement("div"),h=b.createElement("div");return g.className="pageImageContainer",g.style.width=a.pageImage.width+"px",g.style.height=a.pageImage.height+"px",c&&(d=b.createElement("span"),d.className="caption",d.textContent="Page",f.appendChild(d)),h.className="innerPageImageContainer",h.appendChild(a.pageImage),g.appendChild(h),e(g,function(){var b=parseInt(g.style.width,10),c=parseInt(g.style.height,10),d=a.pageImage;a.resizePageImage(b,c,function(a){h.removeChild(d),h.appendChild(a)})}),f.className="outerPageImageContainer",f.appendChild(g),f},h=function(a){var c=b.createElement("div"),d=b.createElement("div"),e=b.createElement("span");return d.className="referenceImageContainer",d.appendChild(a.referenceImage),e.className="caption",e.textContent="Reference",c.className="outerReferenceImageContainer",c.appendChild(e),c.appendChild(d),c},i=function(){var a=b.createElement("span");return a.className="finished",a.style.display="none",a},j=function(a){var c=b.createElement("div"),d=b.createElement("button"),e=i();return d.onclick=function(){a.acceptPage(),e.style.display=""},d.textContent="Accept the rendered page",c.className="saveHint warning",c.appendChild(d),c.appendChild(b.createTextNode("and save this as later reference.")),c.appendChild(e),c},k=function(a){var c=b.createElement("div"),d=b.createElement("button"),e=i();return d.onclick=function(){a.acceptPage(),e.style.display=""},d.textContent="accept the rendered page",c.className="updateHint warning",c.appendChild(b.createTextNode("You can")),c.appendChild(d),c.appendChild(b.createTextNode("thus making it the new reference.")),c.appendChild(e),c},l=function(a){var c=b.createElement("div"),d=b.createElement("ul");return c.className="loadErrors warning",c.appendChild(b.createTextNode("Had the following errors rendering the page:")),c.appendChild(d),a.renderErrors.forEach(function(a){var c=b.createElement("li");c.textContent=a,d.appendChild(c)}),c.appendChild(b.createTextNode("Make sure that resource paths lie within the same origin as this document.")),c},m=function(a){var c=b.createElement("div");return c.className="errorMsg warning",c.textContent="The page '"+a.pageUrl+"' could not be rendered. Make sure the path lies within the same origin as this document.",c},n=function(c){var d=b.createElement("div"),e=b.createElement("div"),f=a.basicHTMLReporterUtil.getDifferenceCanvas(c.pageImage,c.referenceImage),g=a.basicHTMLReporterUtil.getHighlightedDifferenceCanvas(c.pageImage,c.referenceImage);return d.className="differenceCanvasContainer",e.className="innerDifferenceCanvasContainer",d.appendChild(e),f.className="differenceCanvas",e.appendChild(f),g.className="highlightedDifferenceCanvas",e.appendChild(g),d},o=function(a){var c=b.createElement("span");return c.className="status","passed"===a.status?c.textContent="passed":"failed"===a.status?c.textContent="failed":"referenceMissing"===a.status?c.textContent="missing reference":"error"===a.status&&(c.textContent="error"),c},p=function(a){var c=b.createElement("a");return c.className="pageUrl",c.textContent=a.pageUrl,c.href=a.pageUrl,c},q=function(a){var c=b.getElementById(a);return c||(c=b.createElement("div"),c.id=a,c.style.display="none",c.style.position="absolute",b.getElementsByTagName("body")[0].appendChild(c)),c},r=function(a){for(;a.hasChildNodes();)a.removeChild(a.lastChild)},s=function(a,b){a.onmouseover=function(a){var c=q("csscritic_basichtmlreporter_tooltip"),d=b.referenceImage;r(c),c.style.display="block",c.style.top=a.pageY+10+"px",c.style.left=a.pageX+10+"px",c.appendChild(d)},a.onmousemove=function(a){var b=q("csscritic_basichtmlreporter_tooltip");b.style.top=a.pageY+10+"px",b.style.left=a.pageX+10+"px"},a.onmouseout=function(){var a=q("csscritic_basichtmlreporter_tooltip");a.style.display="none"}},t=function(a,b){a.className+=" "+b.status,a.appendChild(o(b)),b.renderErrors&&a.appendChild(l(b)),"failed"===b.status?(a.appendChild(n(b)),a.appendChild(g(b,!0)),a.appendChild(h(b)),a.appendChild(k(b))):"referenceMissing"===b.status?(a.appendChild(j(b)),a.appendChild(g(b))):"error"===b.status?a.appendChild(m(b)):"passed"===b.status&&s(a,b)},u=function(a){var c=b.createElement("div");return c.className="comparison running",c.appendChild(p(a)),c},v=function(a,b){b.className=b.className.replace(" running",""),t(b,a)},w=function(a,b){for(a+="";a.length<b;)a="0"+a;return a},x=function(a){var b=Math.floor(a/1e3),c=a%1e3;return b+"."+w(c,3)};return a.BasicHTMLReporter=function(){var a={},b=null;return{reportComparisonStarting:function(c,d){var e=u(c),g=f();null===b&&(b=Date.now()),g.appendChild(e),a[c.pageUrl]=e,d&&d()},reportComparison:function(b,c){var d=a[b.pageUrl];d||(d=u(b),f().appendChild(d)),v(b,d),c&&c()},report:function(){var a=f(),c=null===b?0:Date.now()-b,d=a.getElementsByClassName("timeTaken")[0];d.textContent="finished in "+x(c)+"s"}}},a}(window.csscritic||{},window.document);